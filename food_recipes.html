<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plexus Care - Smart Meal Planning for Kenyans</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Required Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- IntaSend Inline JS SDK -->
  <script src="https://unpkg.com/intasend-inlinejs-sdk@4.0.7/build/intasend-inline.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f8fafc;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    header {
      background: linear-gradient(135deg, #3b82f6, #ec4899);
      color: white;
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      transition: opacity 0.3s;
    }

    .nav-links a:hover {
      opacity: 0.8;
    }

    /* Hero Section */
    .hero {
      background: linear-gradient(135deg, #3b82f6, #ec4899);
      color: white;
      padding: 4rem 0;
      text-align: center;
    }

    .hero h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .hero p {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .cta-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: white;
      color: #3b82f6;
    }

    .btn-secondary {
      background: transparent;
      color: white;
      border: 2px solid white;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* Main Content Sections */
    .section {
      padding: 4rem 0;
      margin-bottom: 2rem;
    }

    .section-title {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 3rem;
      color: #1e293b;
    }

    /* Meal Planner Section */
    .meal-planner {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }

    .planner-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #374151;
    }

    .form-group input,
    .form-group select {
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3b82f6;
    }

    /* Diet Setup Section */
    .diet-setup {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .diet-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .diet-card {
      background: #f8fafc;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .diet-card:hover,
    .diet-card.active {
      border-color: #97b8f7;
      background: #eff6ff;
    }

    .diet-card i {
      font-size: 2rem;
      color: #97b8f7;
      margin-bottom: 1rem;
    }

    .diet-card h3 {
      margin-bottom: 0.5rem;
      color: #1e293b;
    }

    .diet-card p {
      font-size: 0.9rem;
      color: #6b7280;
    }

    /* Personal Info Form */
    .personal-info {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-top: 2rem;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .radio-group {
      display: flex;
      gap: 1rem;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .radio-option:hover,
    .radio-option.active {
      border-color: #3b82f6;
      background: #eff6ff;
    }

    /* Meal Results */
    .meal-results {
      margin-top: 2rem;
      padding: 1.5rem;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
    }

    .meal-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .meal-card {
      flex: 1 1 300px;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .meal-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .meal-card .card-img-top {
      height: 200px;
      object-fit: cover;
      width: 100%;
    }

    .meal-card .card-body {
      padding: 1.25rem;
    }

    .meal-card .card-title {
      color: #2c3e50;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .meal-card .price {
      font-size: 1.1rem;
      font-weight: 700;
      color: #2ecc71;
      margin: 0.5rem 0;
    }

    .meal-card .ingredients {
      font-size: 0.9rem;
      color: #6c757d;
      margin-bottom: 1rem;
    }

    .meal-instructions {
      margin-top: 1rem;
      padding: 1rem;
      background-color: #f8f9fa;
      border-radius: 6px;
      border-left: 4px solid #3b82f6;
    }

    .meal-instructions h6 {
      color: #2c3e50;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .hidden {
      display: none !important;
    }

    .fadeIn {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .btn-outline-secondary.toggle-instructions {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: auto;
    }

    .meal-results h3 {
      color: #2c3e50;
      font-weight: 700;
      border-bottom: 2px solid #f1f1f1;
      padding-bottom: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .alert-warning {
      background-color: #fff3cd;
      border-color: #ffeeba;
      color: #856404;
      padding: 1rem;
      border-radius: 6px;
    }
    }

    .meal-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
    }

    .meal-card:hover {
      transform: translateY(-4px);
    }

    .meal-image {
      width: 100%;
      height: 200px;
      background: linear-gradient(45deg, #3b82f6, #ec4899);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 3rem;
    }

    .meal-content {
      padding: 1.5rem;
    }

    .meal-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1e293b;
    }

    .meal-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .meal-price {
      font-size: 1.1rem;
      font-weight: 600;
      color: #97b8f7;
    }

    .meal-servings {
      font-size: 0.9rem;
      color: #6b7280;
    }

    .ingredients-list {
      margin-bottom: 1rem;
    }

    .ingredients-list h4 {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      color: #374151;
    }

    .ingredients {
      font-size: 0.8rem;
      color: #6b7280;
      line-height: 1.4;
    }

    /* Nutrition Tracker */
    .nutrition-tracker {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .nutrition-chart {
      width: 300px;
      height: 300px;
      margin: 2rem auto;
      border-radius: 50%;
      background: conic-gradient(#3b82f6 0deg 120deg,
          #ec4899 120deg 240deg,
          #10b981 240deg 360deg);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .chart-center {
      width: 200px;
      height: 200px;
      background: white;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #1e293b;
    }

    .nutrition-legend {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 1rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }

    /* Premium Features */
    .premium-banner {
      background: linear-gradient(135deg, #1e293b, #374151);
      color: white;
      padding: 3rem;
      border-radius: 12px;
      text-align: center;
      margin: 2rem 0;
    }

    .premium-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .feature-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 1.5rem;
      border-radius: 8px;
      text-align: left;
    }

    .feature-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #ec4899;
    }

    /* Shopping Cart */
    .shopping-section {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-top: 2rem;
    }

    .cart-items {
      margin-bottom: 2rem;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .cart-total {
      background: #f8fafc;
      padding: 1.5rem;
      border-radius: 8px;
      text-align: center;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2rem;
      }

      .nav-links {
        display: none;
      }

      .planner-form {
        grid-template-columns: 1fr;
      }

      .cta-buttons {
        flex-direction: column;
        align-items: center;
      }

      .radio-group {
        flex-direction: column;
      }
    }

    /* Utilities */
    .hidden {
      display: none;
    }

    .text-center {
      text-align: center;
    }

    .mt-2 {
      margin-top: 1rem;
    }

    .mb-2 {
      margin-bottom: 1rem;
    }
  </style>
  <style>
    /* Personalized Meal Plans Styling */
    .meal-plan-tabs .nav-tabs {
      border-bottom: 2px solid #dee2e6;
      margin-bottom: 1.5rem;
    }
    
    .meal-plan-tabs .nav-link {
      border: none;
      color: #6c757d;
      font-weight: 500;
      padding: 0.75rem 1.5rem;
      margin: 0 0.25rem;
      border-radius: 0.5rem 0.5rem 0 0;
      transition: all 0.3s ease;
    }
    
    .meal-plan-tabs .nav-link.active {
      background-color: #4a6cf7;
      color: white;
      border: none;
      box-shadow: 0 4px 12px rgba(74, 108, 247, 0.2);
    }
    
    .meal-plan-tabs .nav-link:hover:not(.active) {
      background-color: #f8f9fa;
      color: #4a6cf7;
    }
    
    .meal-plan-card {
      border: none;
      border-radius: 1rem;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      height: 100%;
      background: #fff;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .meal-plan-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .meal-plan-header {
      background: linear-gradient(135deg, #4a6cf7 0%, #2541b2 100%);
      color: white;
      padding: 1.25rem;
      text-align: center;
    }
    
    .meal-plan-body {
      padding: 1.5rem;
    }
    
    .meal-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid #f1f3f9;
    }
    
    .meal-item:last-child {
      border-bottom: none;
    }
    
    .meal-time {
      font-weight: 600;
      color: #4a6cf7;
      min-width: 80px;
    }
    
    .meal-name {
      flex: 1;
      margin: 0 1rem;
    }
    
    .meal-calories {
      color: #6c757d;
      font-size: 0.875rem;
    }
    
    .nutrition-facts {
      background: #f8f9fa;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-top: 1rem;
    }
    
    .nutrition-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    
    .nutrition-label {
      color: #6c757d;
    }
    
    .nutrition-value {
      font-weight: 600;
    }
    
    .meal-plan-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }
    
    /* Footer Styling */
    .footer {
      background-color: #2c3e50;
      color: #ecf0f1;
      padding: 3rem 0 1.5rem;
      margin-top: 3rem;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .footer-section h3 {
      color: #3498db;
      margin-bottom: 1rem;
    }

    .footer-section p,
    .footer-section a {
      color: #bdc3c7;
      margin-bottom: 0.5rem;
      display: block;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-section a:hover {
      color: #3498db;
    }

    .footer-section ul {
      list-style: none;
      padding: 0;
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #7f8c8d;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .footer-content {
        grid-template-columns: 1fr;
        text-align: center;
      }

      .footer-section {
        margin-bottom: 1.5rem;
      }
    }

    /* New Sections Styling */
    .portion-circle {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background-color: #f8f9fa;
      position: relative;
      border: 10px solid #e9ecef;
      margin: 0 auto;
    }

    .portion-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #4dabf7;
      border-radius: 0 0 90px 90px;
      transition: height 0.5s ease;
      height: 30%;
    }

    .portion-text {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      transform: translateY(-50%);
      text-align: center;
      z-index: 2;
    }

    .portion-text span {
      display: block;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .recipe-card {
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      height: 100%;
    }

    .recipe-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .recipe-card .card-body {
      min-height: 150px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: center;
    }

    .feature-card {
      background: white;
      border-radius: 10px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .feature-icon {
      color: #3b82f6;
    }

    .icon-lg {
      width: 70px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
    }

    .feature-list {
      list-style: none;
      padding-left: 0;
    }

    .feature-list li {
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
    }

    .budget-visualization {
      border-left: 4px solid #10b981;
    }

    /* Notification animations */
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
      }
    }

    /* Tab navigation */
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 2rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .tab-link {
      padding: 1rem 2rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      font-weight: 600;
      color: #6b7280;
    }

    .tab-link:hover {
      color: #3b82f6;
    }

    .tab-link.active {
      color: #3b82f6;
      border-bottom-color: #97b8f7;
    }

    .tab-content {
      display: none;
    }

    /* Cart styles */
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .cart-item-details h4 {
      margin: 0;
      margin-bottom: 0.5rem;
    }

    .cart-item-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .cart-item-total {
      font-weight: 600;
    }

    .btn-remove {
      background: #fef2f2;
      color: #dc2626;
      border: none;
      padding: 0.5rem;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-remove:hover {
      background: #fee2e2;
    }

    /* Footer styles */
    .footer {
      background: #97b8f7;
      color: #f9fafb;
      padding: 4rem 0 2rem;
      margin-top: 4rem;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .footer-section h3 {
      color: #fff;
      margin-bottom: 1rem;
      font-size: 1.25rem;
    }

    .footer-section h4 {
      color: #e5e7eb;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .footer-section ul {
      list-style: none;
      padding: 0;
    }

    .footer-section ul li {
      margin-bottom: 0.5rem;
    }

    .footer-section a {
      color: #d1d5db;
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer-section a:hover {
      color: white;
    }

    .footer-bottom {
      text-align: center;
      padding-top: 2rem;
      border-top: 1px solid #374151;
      color: #f8f9fa;
      font-size: 0.9rem;
    }

    /* Wizard Styles */
    .wizard-container {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .wizard-progress {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
      position: relative;
    }

    .wizard-progress::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      right: 0;
      height: 2px;
      background: #e5e7eb;
      z-index: 1;
    }

    .progress-step {
      position: relative;
      z-index: 2;
      background: white;
      padding: 0 1rem;
      color: #9ca3af;
      font-weight: 500;
      text-align: center;
    }

    .progress-step::before {
      content: '';
      display: block;
      width: 30px;
      height: 30px;
      margin: 0 auto 0.5rem;
      border: 2px solid #e5e7eb;
      border-radius: 50%;
      background: white;
      line-height: 28px;
      font-weight: bold;
      color: #9ca3af;
    }

    .progress-step.active {
      color: #3b82f6;
    }

    .progress-step.active::before {
      border-color: #3b82f6;
      color: #3b82f6;
    }

    .progress-step.completed::before {
      content: '✓';
      background: #3b82f6;
      border-color: #3b82f6;
      color: white;
    }

    .wizard-step {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .wizard-step.active {
      display: block;
    }

    .diet-options,
    .activity-options,
    .goal-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .diet-option,
    .activity-option,
    .goal-option {
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .diet-option:hover,
    .activity-option:hover,
    .goal-option:hover {
      border-color: #3b82f6;
    }

    .diet-option input[type="radio"],
    .activity-option input[type="radio"],
    .goal-option input[type="radio"] {
      display: none;
    }

    .diet-option input[type="radio"]:checked+label,
    .activity-option input[type="radio"]:checked+label,
    .goal-option input[type="radio"]:checked+label {
      color: #3b82f6;
    }

    .diet-option input[type="radio"]:checked+label h4,
    .activity-option input[type="radio"]:checked+label h4,
    .goal-option input[type="radio"]:checked+label h4 {
      color: #3b82f6;
    }

    .avoidance-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 0.75rem;
      margin: 1.5rem 0;
    }

    .avoidance-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .avoidance-option input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .radio-group {
      display: flex;
      gap: 1.5rem;
      margin-top: 0.5rem;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .wizard-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e5e7eb;
    }

    /* Grocery Shopping Styles */
    .category-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .filter-btn {
      border-radius: 20px;
      padding: 0.375rem 1rem;
    }

    .filter-btn.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .meal-image {
      height: 200px;
      object-fit: cover;
      width: 100%;
    }

    .card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: none;
      margin-bottom: 1.5rem;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid #eee;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-summary {
      background-color: #f8f9fa;
      padding: 1.25rem;
      border-radius: 0.5rem;
      margin-top: 1rem;
    }

    #grocery-cart-icon {
      transition: transform 0.3s ease;
    }

    #grocery-cart-icon.pop {
      transform: scale(1.2) rotate(-10deg);
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1100;
      min-width: 250px;
    }

    .quantity-input {
      max-width: 80px;
      text-align: center;
    }

    .remove-item {
      padding: 0.25rem 0.5rem;
      line-height: 1;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {

      .tabs,
      .wizard-progress {
        flex-wrap: wrap;
      }

      .progress-step {
        flex: 1 0 50%;
        margin-bottom: 1rem;
      }

      .tab-link,
      .progress-step {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
      }

      .diet-options,
      .activity-options,
      .goal-options {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .radio-group {
        flex-direction: column;
        gap: 0.5rem;
      }

      .footer-content {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <nav class="container">
      <div class="logo"><i class="fas fa-heartbeat"></i>
        <span>Plexus Care</span>
      </div>
      <ul class="nav-links">
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="Symptom_Checker.html">Symptoms Checker</a></li>
        <li><a href="Drugs_supl.html">Drugs & Supplements</a></li>
        <li><a href="Doctor.html">Find a Doctor</a></li>
        <li><a href="wellness.html">Wellness</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>

  <!-- Hero Section -->
  <section class="hero" id="home">
    <div class="container">
      <h1>Smart Meal Planning for Kenyans</h1>
      <p>Plan your meals, track your nutrition, and shop for ingredients - all in one place. Designed specifically for
        Kenyan families and budgets.</p>
      <div class="cta-buttons">
        <a href="#meal-planner" class="btn btn-primary">
          <i class="fas fa-utensils"></i>
          Start Planning Meals
        </a>
        <a href="#diet-tracker" class="btn btn-secondary">
          <i class="fas fa-chart-pie"></i>
          Track Your Diet
        </a>
      </div>
    </div>
  </section>

  <!-- Profile Setup Wizard -->
  <section class="section" id="profile-setup">
    <div class="container">
      <h2 class="section-title">Set Up Your Dietary Profile</h2>

      <div class="wizard-container">
        <!-- Progress Bar -->
        <div class="wizard-progress">
          <div class="progress-step active" data-step="1">1. Diet Type</div>
          <div class="progress-step" data-step="2">2. Food Restrictions</div>
          <div class="progress-step" data-step="3">3. Personal Info</div>
          <div class="progress-step" data-step="4">4. Activity & Goals</div>
        </div>

        <!-- Wizard Form -->
        <form id="dietProfileForm" class="wizard-form">
          <!-- Step 1: Diet Type -->
          <div class="wizard-step active" data-step="1">
            <h3>Choose Your Diet Type</h3>
            <div class="diet-options">
              <div class="diet-option">
                <input type="radio" id="diet-anything" name="dietType" value="anything" checked>
                <label for="diet-anything">
                  <h4>Anything</h4>
                  <p>No dietary restrictions</p>
                </label>
              </div>
              <div class="diet-option">
                <input type="radio" id="diet-keto" name="dietType" value="keto">
                <label for="diet-keto">
                  <h4>Keto</h4>
                  <p>Excludes: High-carb grains, refined starches, sugar</p>
                </label>
              </div>
              <div class="diet-option">
                <input type="radio" id="diet-mediterranean" name="dietType" value="mediterranean">
                <label for="diet-mediterranean">
                  <h4>Mediterranean</h4>
                  <p>Excludes: Red meat, fruit juice, processed meats</p>
                </label>
              </div>
              <div class="diet-option">
                <input type="radio" id="diet-paleo" name="dietType" value="paleo">
                <label for="diet-paleo">
                  <h4>Paleo</h4>
                  <p>Excludes: Dairy, grains, legumes, refined starches</p>
                </label>
              </div>
              <div class="diet-option">
                <input type="radio" id="diet-vegan" name="dietType" value="vegan">
                <label for="diet-vegan">
                  <h4>Vegan</h4>
                  <p>Excludes: All animal products</p>
                </label>
              </div>
              <div class="diet-option">
                <input type="radio" id="diet-vegetarian" name="dietType" value="vegetarian">
                <label for="diet-vegetarian">
                  <h4>Vegetarian</h4>
                  <p>Excludes: Meat, poultry, fish</p>
                </label>
              </div>
            </div>
          </div>

          <!-- Step 2: Food Restrictions -->
          <div class="wizard-step" data-step="2">
            <h3>Foods to Avoid</h3>
            <p class="mb-3">Select any foods you avoid due to allergies or preferences:</p>
            <div class="avoidance-options">
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-dairy" name="avoid" value="dairy">
                <label for="avoid-dairy">Dairy</label>
              </div>
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-eggs" name="avoid" value="eggs">
                <label for="avoid-eggs">Eggs</label>
              </div>
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-fish" name="avoid" value="fish">
                <label for="avoid-fish">Fish</label>
              </div>
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-gluten" name="avoid" value="gluten">
                <label for="avoid-gluten">Gluten</label>
              </div>
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-peanuts" name="avoid" value="peanuts">
                <label for="avoid-peanuts">Peanuts</label>
              </div>
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-sesame" name="avoid" value="sesame">
                <label for="avoid-sesame">Sesame</label>
              </div>
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-shellfish" name="avoid" value="shellfish">
                <label for="avoid-shellfish">Shellfish</label>
              </div>
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-soy" name="avoid" value="soy">
                <label for="avoid-soy">Soy</label>
              </div>
              <div class="avoidance-option">
                <input type="checkbox" id="avoid-treenuts" name="avoid" value="treenuts">
                <label for="avoid-treenuts">Tree Nuts</label>
              </div>
            </div>
          </div>

          <!-- Step 3: Personal Info -->
          <div class="wizard-step" data-step="3">
            <h3>Tell Us About Yourself</h3>
            <p class="mb-3">This information helps us estimate your daily nutrition requirements.</p>

            <div class="form-group">
              <label>Sex</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" id="sex-male" name="sex" value="male" checked>
                  <label for="sex-male">Male</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="sex-female" name="sex" value="female">
                  <label for="sex-female">Female</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="sex-other" name="sex" value="other">
                  <label for="sex-other">Non-Binary</label>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="height">Height (cm)</label>
                <input type="number" id="height" name="height" min="100" max="250" required>
              </div>

              <div class="form-group">
                <label for="weight">Weight (kg)</label>
                <input type="number" id="weight" name="weight" min="30" max="300" step="0.1" required>
              </div>

              <div class="form-group">
                <label for="age">Age (years)</label>
                <input type="number" id="age" name="age" min="12" max="120" required>
              </div>
            </div>

            <div class="form-group">
              <label>Body Fat</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" id="fat-low" name="bodyFat" value="low" checked>
                  <label for="fat-low">Low</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="fat-medium" name="bodyFat" value="medium">
                  <label for="fat-medium">Medium</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="fat-high" name="bodyFat" value="high">
                  <label for="fat-high">High</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 4: Activity & Goals -->
          <div class="wizard-step" data-step="4">
            <h3>Activity Level</h3>
            <div class="activity-options">
              <div class="activity-option">
                <input type="radio" id="activity-sedentary" name="activityLevel" value="sedentary" checked>
                <label for="activity-sedentary">
                  <h4>Sedentary</h4>
                  <p>Little or no exercise</p>
                </label>
              </div>
              <div class="activity-option">
                <input type="radio" id="activity-light" name="activityLevel" value="light">
                <label for="activity-light">
                  <h4>Lightly Active</h4>
                  <p>Light exercise 1-3 days/week</p>
                </label>
              </div>
              <div class="activity-option">
                <input type="radio" id="activity-moderate" name="activityLevel" value="moderate">
                <label for="activity-moderate">
                  <h4>Moderately Active</h4>
                  <p>Moderate exercise 3-5 days/week</p>
                </label>
              </div>
              <div class="activity-option">
                <input type="radio" id="activity-active" name="activityLevel" value="active">
                <label for="activity-active">
                  <h4>Very Active</h4>
                  <p>Hard exercise 6-7 days/week</p>
                </label>
              </div>
            </div>

            <h3 class="mt-4">What is Your Goal?</h3>
            <p class="mb-3">We'll adjust your daily nutrition targets to match your goals.</p>

            <div class="goal-options">
              <div class="goal-option">
                <input type="radio" id="goal-lose" name="goal" value="lose" checked>
                <label for="goal-lose">
                  <h4>Lose Fat</h4>
                  <p>Gradual weight loss</p>
                </label>
              </div>
              <div class="goal-option">
                <input type="radio" id="goal-maintain" name="goal" value="maintain">
                <label for="goal-maintain">
                  <h4>Maintain Weight</h4>
                  <p>Stay at current weight</p>
                </label>
              </div>
              <div class="goal-option">
                <input type="radio" id="goal-gain" name="goal" value="gain">
                <label for="goal-gain">
                  <h4>Build Muscle</h4>
                  <p>Gain muscle mass</p>
                </label>
              </div>
            </div>
          </div>

          <!-- Navigation Buttons -->
          <div class="wizard-navigation">
            <button type="button" class="btn btn-secondary" id="prevBtn" disabled>Previous</button>
            <button type="button" class="btn btn-primary" id="nextBtn">Next</button>
            <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">Complete Setup</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Diet Tracker Section (hidden by default) -->
  <section class="section" id="diet-tracker" style="display: none;">

    <!-- Diet Type Selection -->
    <div class="diet-setup">
      <h3 class="mb-2">Choose Your Diet Type</h3>
      <div class="diet-options">
        <div class="diet-card" data-diet="anything">
          <i class="fas fa-utensils"></i>
          <h3>Anything</h3>
          <p>Excludes: Nothing</p>
        </div>
        <div class="diet-card" data-diet="keto">
          <i class="fas fa-cheese"></i>
          <h3>Keto</h3>
          <p>Excludes: High-carb grains, refined starches, sugar</p>
        </div>
        <div class="diet-card" data-diet="mediterranean">
          <i class="fas fa-fish"></i>
          <h3>Mediterranean</h3>
          <p>Excludes: Red meat, fruit juice, processed meats</p>
        </div>
        <div class="diet-card" data-diet="paleo">
          <i class="fas fa-drumstick-bite"></i>
          <h3>Paleo</h3>
          <p>Excludes: Dairy, grains, legumes, refined starches</p>
        </div>
        <div class="diet-card" data-diet="vegan">
          <i class="fas fa-leaf"></i>
          <h3>Vegan</h3>
          <p>Excludes: All animal products</p>
        </div>
        <div class="diet-card" data-diet="vegetarian">
          <i class="fas fa-carrot"></i>
          <h3>Vegetarian</h3>
          <p>Excludes: Meat, poultry, fish</p>
        </div>
      </div>

      <!-- Food Allergies/Avoidances -->
      <div class="mb-2">
        <h3>Foods to Avoid</h3>
        <p>Select any foods you avoid due to allergies or preferences:</p>
        <div class="diet-options">
          <div class="diet-card" data-avoid="dairy">Dairy</div>
          <div class="diet-card" data-avoid="eggs">Eggs</div>
          <div class="diet-card" data-avoid="fish">Fish</div>
          <div class="diet-card" data-avoid="gluten">Gluten</div>
          <div class="diet-card" data-avoid="peanuts">Peanuts</div>
          <div class="diet-card" data-avoid="sesame">Sesame</div>
          <div class="diet-card" data-avoid="shellfish">Shellfish</div>
          <div class="diet-card" data-avoid="soy">Soy</div>
          <div class="diet-card" data-avoid="tree-nuts">Tree Nuts</div>
        </div>
      </div>
    </div>

    <!-- Personal Information -->
    <div class="personal-info">
      <h3 class="mb-2">Tell Us About Yourself</h3>
      <p class="mb-2">This information helps us estimate your daily nutrition requirements.</p>

      <form class="info-grid" id="personalInfoForm">
        <div class="form-group">
          <label>Sex</label>
          <div class="radio-group">
            <div class="radio-option" data-value="male">
              <input type="radio" name="sex" value="male">
              <span>Male</span>
            </div>
            <div class="radio-option" data-value="female">
              <input type="radio" name="sex" value="female">
              <span>Female</span>
            </div>
            <div class="radio-option" data-value="non-binary">
              <input type="radio" name="sex" value="non-binary">
              <span>Non-Binary</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="height">Height (cm)</label>
          <input type="number" id="height" name="height" placeholder="e.g., 170">
        </div>

        <div class="form-group">
          <label for="weight">Weight (kg)</label>
          <input type="number" id="weight" name="weight" placeholder="e.g., 70">
        </div>

        <div class="form-group">
          <label for="age">Age (years)</label>
          <input type="number" id="age" name="age" placeholder="e.g., 30">
        </div>

        <div class="form-group">
          <label>Body Fat</label>
          <div class="radio-group">
            <div class="radio-option" data-value="low">Low</div>
            <div class="radio-option" data-value="medium">Medium</div>
            <div class="radio-option" data-value="high">High</div>
          </div>
        </div>

        <div class="form-group">
          <label for="activity">Activity Level</label>
          <select id="activity" name="activity">
            <option value="sedentary">Desk job, light exercise</option>
            <option value="light">Light exercise 1-3 days/week</option>
            <option value="moderate">Moderate exercise 3-5 days/week</option>
            <option value="heavy">Heavy exercise 6-7 days/week</option>
            <option value="extra">Very heavy physical work</option>
          </select>
        </div>
      </form>

      <div class="text-center mt-2">
        <button class="btn btn-primary" onclick="calculateNutrition()">
          <i class="fas fa-calculator"></i>
          Calculate My Nutrition Targets
        </button>
      </div>
    </div>

    <!-- Goal Setting -->
    <div class="personal-info mt-2">
      <h3 class="mb-2">What is Your Goal?</h3>
      <p class="mb-2">We'll adjust your daily nutrition targets to match your goals.</p>

      <div class="radio-group">
        <div class="radio-option" data-goal="lose-fat">
          <i class="fas fa-weight"></i>
          <span>Lose Fat</span>
        </div>
        <div class="radio-option" data-goal="maintain">
          <i class="fas fa-balance-scale"></i>
          <span>Maintain Weight</span>
        </div>
        <div class="radio-option" data-goal="build-muscle">
          <i class="fas fa-dumbbell"></i>
          <span>Build Muscle</span>
        </div>
      </div>
    </div>

    <!-- Nutrition Targets Display -->
    <div class="nutrition-tracker" id="nutritionTargets" style="display: none;">
      <h3 class="text-center mb-2">Your Nutrition Targets</h3>
      <p class="text-center mb-2">We've estimated your daily nutrition targets based on your profile.</p>

      <div class="nutrition-chart">
        <div class="chart-center">
          <div style="font-size: 2rem;" id="targetCalories">1800</div>
          <div>Calories/day</div>
        </div>
      </div>

      <div class="nutrition-legend">
        <div class="legend-item">
          <div class="legend-color" style="background: #3b82f6;"></div>
          <span>Carbs: <span id="targetCarbs">45%</span></span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ec4899;"></div>
          <span>Protein: <span id="targetProtein">25%</span></span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #10b981;"></div>
          <span>Fat: <span id="targetFat">30%</span></span>
        </div>
      </div>

      <div style="margin-top: 2rem; padding: 1rem; background: #f8fafc; border-radius: 8px;">
        <h4>Daily Targets:</h4>
        <p><strong>Calories:</strong> <span id="caloriesTarget">1800</span> per day</p>
        <p><strong>Carbs:</strong> At least <span id="carbsTarget">203g</span></p>
        <p><strong>Fat:</strong> At least <span id="fatTarget">60g</span></p>
        <p><strong>Protein:</strong> At least <span id="proteinTarget">113g</span></p>
      </div>

      <div class="text-center mt-2">
        <button class="btn btn-primary">Edit Targets</button>
      </div>
    </div>

    <!-- Daily Meal Tracking -->
    <div class="nutrition-tracker mt-2">
      <h3 class="text-center mb-2">Today's Meals</h3>

      <div class="meal-tracking">
        <div class="meal-section">
          <h4><i class="fas fa-coffee"></i> Breakfast - 379 Calories</h4>
          <div class="tracked-meal">
            <div>Lentil & Chickpea Avocado Toast - 1 serving</div>
            <button class="btn btn-secondary">Edit</button>
          </div>
        </div>

        <div class="meal-section">
          <h4><i class="fas fa-hamburger"></i> Lunch - 341 Calories</h4>
          <div class="tracked-meal">
            <div>Turkey, Ham, and Avocado on Rye - 1 sandwich</div>
            <button class="btn btn-secondary">Edit</button>
          </div>
        </div>

        <div class="meal-section">
          <h4><i class="fas fa-drumstick-bite"></i> Dinner - 414 Calories</h4>
          <div class="tracked-meal">
            <div>Super Simple Smoked Paprika Chicken - 1 serving</div>
            <button class="btn btn-secondary">Edit</button>
          </div>
        </div>
      </div>

      <div class="text-center mt-2">
        <button class="btn btn-primary">
          <i class="fas fa-plus"></i>
          Add Meal
        </button>
      </div>
    </div>
    </div>
  </section>

  <!-- Meal Planner Section -->
  <section class="section" id="meal-planner">
    <div class="container">
      <h2 class="section-title">Plan Your Meals</h2>

      <div class="meal-planner">
        <h3 class="mb-2">Tell us about your meal needs</h3>
        <form class="planner-form" id="mealPlannerForm">
          <div class="form-group">
            <label for="mealType">Meal Type</label>
            <select id="mealType" name="mealType" required>
              <option value="">Select meal type</option>
              <option value="breakfast">Breakfast</option>
              <option value="lunch">Lunch</option>
              <option value="dinner">Dinner</option>
              <option value="snack">Snack</option>
              <option value="all">All meals</option>
            </select>
          </div>

          <div class="form-group">
            <label for="people">Number of People (Max 10)</label>
            <input type="number" id="people" name="people" min="1" max="10" value="1" placeholder="e.g., 4" required>
            <small class="form-text text-muted">Maximum of 10 people per order</small>
          </div>

          <div class="form-group">
            <label for="budget">Total Budget (KES)</label>
            <input type="number" id="budget" name="budget" min="100" value="500" placeholder="e.g., 2000" required>
            <div id="budgetWarning" class="alert alert-warning small mt-2 d-none">
              <i class="fas fa-exclamation-triangle me-1"></i> Your budget seems too low for the number of people.
              Consider increasing it for better options.
            </div>
            <small class="form-text text-muted">Minimum KES 100 per person recommended</small>
          </div>

          <div class="form-group">
            <label for="cuisine">Preferred Cuisine</label>
            <select id="cuisine" name="cuisine">
              <option value="">Any cuisine</option>
              <option value="kenyan">Kenyan Traditional</option>
              <option value="coastal">Coastal</option>
              <option value="international">International</option>
              <option value="vegetarian">Vegetarian</option>
            </select>
          </div>
        </form>

        <div class="text-center">
          <button class="btn btn-primary" onclick="generateMeals()">
            <i class="fas fa-magic"></i>
            Generate Meal Suggestions
          </button>
        </div>
      </div>

      <!-- Meal Results -->
      <div id="mealResults" class="meal-results hidden">
        <!-- Meals will be dynamically generated here -->
      </div>
    </div>
  </section>

  <!-- Grocery Shopping Section -->
  <section class="section" id="shop">
    <div class="container">
      <h2 class="section-title">Grocery Shopping</h2>

      <!-- Category Filters -->
      <div class="category-filters mb-4">
        <button class="btn btn-outline-secondary filter-btn active" data-category="all">All Items</button>
        <button class="btn btn-outline-secondary filter-btn" data-category="fruits">Fruits</button>
        <button class="btn btn-outline-secondary filter-btn" data-category="vegetables">Vegetables</button>
        <button class="btn btn-outline-secondary filter-btn" data-category="dairy">Dairy</button>
        <button class="btn btn-outline-secondary filter-btn" data-category="grains">Grains</button>
        <button class="btn btn-outline-secondary filter-btn" data-category="meats">Meats</button>
      </div>

      <div class="row">
        <!-- Grocery Items -->
        <div class="col-lg-8">
          <div class="row" id="grocery-items">
            <!-- Grocery items will be dynamically inserted here -->
          </div>
        </div>

        <!-- Shopping Cart -->
        <div class="col-lg-4">
          <div class="card shadow-sm">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="fas fa-shopping-cart me-2" id="grocery-cart-icon"></i>
                Shopping Cart
                <span class="badge bg-light text-dark ms-2" id="cart-count">0</span>
              </h5>
              <button class="btn btn-sm btn-light" id="empty-cart">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="delivery-location" class="form-label">Delivery Location</label>
                <select id="delivery-location" class="form-select">
                  <option value="nairobi">Nairobi - KSH 150</option>
                  <option value="kisumu">Kisumu - KSH 200</option>
                  <option value="mombasa">Mombasa - KSH 250</option>
                  <option value="eldoret">Eldoret - KSH 180</option>
                </select>
              </div>
              <hr>
              <div class="cart-items">
                <ul class="list-unstyled mb-3" id="cart-items">
                  <!-- Cart items will be dynamically inserted here -->
                  <li class="text-muted text-center py-2">Your cart is empty</li>
                </ul>
              </div>
              <div class="cart-summary">
                <div class="d-flex justify-content-between mb-2">
                  <span>Subtotal:</span>
                  <span>KSH <span id="cart-subtotal">0</span></span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>Delivery Fee:</span>
                  <span>KSH <span id="delivery-fee">0</span></span>
                </div>
                <div class="d-flex justify-content-between fw-bold">
                  <span>Total:</span>
                  <span>KSH <span id="cart-total">0</span></span>
                </div>
                <button id="checkout-btn" class="intaSendPayButton btn btn-primary w-100 mt-3" data-amount="1000"
                  data-currency="KES">
                  <i class="fas fa-credit-card me-2"></i>Pay Now
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Modal -->
      <div class="modal fade" id="paymentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Complete Your Payment</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div id="intasend-widget">
                <!-- IntaSend payment widget will be loaded here -->
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p class="mt-2">Loading payment options...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Toast Notification -->
      <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="toast-header">
            <strong class="me-auto">Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body"></div>
        </div>
      </div>


    </div>
  </section>

  <!-- Personalized Meal Plans -->
  <section class="section bg-light" id="personalized-plans">
    <div class="container">
      <div class="text-center mb-5">
        <h2 class="section-title">Your Personalized Meal Plans</h2>
        <p class="text-muted">Customized meal plans tailored to your dietary preferences and goals</p>
      </div>

      <!-- Plan Selection Tabs -->
      <div class="meal-plan-tabs">
        <ul class="nav nav-tabs justify-content-center mb-4" id="mealPlanTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="weekly-tab" data-bs-toggle="tab" data-bs-target="#weekly-plan"
              type="button" role="tab">
              <i class="fas fa-calendar-week me-2"></i>Weekly Plan
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="portions-tab" data-bs-toggle="tab" data-bs-target="#portions" type="button"
              role="tab">
              <i class="fas fa-utensil-spoon me-2"></i>Portion Control
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="swaps-tab" data-bs-toggle="tab" data-bs-target="#recipe-swaps" type="button"
              role="tab">
              <i class="fas fa-exchange-alt me-2"></i>Recipe Swaps
            </button>
          </li>
        </ul>
      </div>

      <!-- Tab Content -->
      <div class="tab-content" id="mealPlanTabsContent">
        <!-- Weekly Plan Tab -->
        <div class="tab-pane fade show active" id="weekly-plan" role="tabpanel" aria-labelledby="weekly-tab">
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body p-4">
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label fw-medium text-muted">Diet Type</label>
                    <select class="form-select form-select-lg" id="dietType">
                      <option value="balanced">Balanced</option>
                      <option value="keto">Keto</option>
                      <option value="vegetarian">Vegetarian</option>
                      <option value="vegan">Vegan</option>
                      <option value="low-carb">Low-Carb</option>
                      <option value="mediterranean">Mediterranean</option>
                      <option value="paleo">Paleo</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="mb-3">
                    <label class="form-label fw-medium text-muted">Meals Per Day</label>
                    <select class="form-select form-select-lg" id="mealsPerDay">
                      <option value="3">3 Meals</option>
                      <option value="4">4 Meals (with snack)</option>
                      <option value="5">5 Meals (with 2 snacks)</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="mb-3">
                    <label class="form-label fw-medium text-muted">Duration</label>
                    <select class="form-select form-select-lg" id="planDuration">
                      <option value="7">1 Week</option>
                      <option value="14">2 Weeks</option>
                      <option value="30">1 Month</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                  <button class="btn btn-primary btn-lg w-100" id="generateMealPlan">
                    <i class="fas fa-magic me-2"></i>Generate
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div id="mealPlanPreview" class="mb-5">
            <div class="alert alert-info d-flex align-items-center">
              <i class="fas fa-info-circle fs-4 me-3"></i>
              <div>
                <h5 class="alert-heading mb-1">Let's Get Started!</h5>
                <p class="mb-0">Select your preferences and click "Generate" to create your personalized meal plan.</p>
              </div>
            </div>
            
            <div id="mealPlanContainer" class="d-none">
              <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
                <div>
                  <h3 class="mb-1">Your Meal Plan</h3>
                  <p class="text-muted mb-0">Tailored to your dietary preferences and goals</p>
                </div>
                <div class="mt-3 mt-md-0">
                  <div class="btn-group" role="group">
                    <button class="btn btn-outline-primary" id="printMealPlan">
                      <i class="fas fa-print me-2"></i>Print
                    </button>
                    <button class="btn btn-outline-success" id="saveMealPlan">
                      <i class="fas fa-save me-2"></i>Save
                    </button>
                    <button class="btn btn-primary" id="shopForPlan">
                      <i class="fas fa-shopping-cart me-2"></i>Shop Now
                    </button>
                  </div>
                </div>
              </div>
              <div id="mealPlanDays" class="row g-4">
                <!-- Sample day template - will be populated by JavaScript -->
                <div class="col-12">
                  <div class="meal-plan-card">
                    <div class="meal-plan-header">
                      <h4 class="mb-0">Day 1</h4>
                      <span class="badge bg-white text-primary">2,100 kcal</span>
                    </div>
                    <div class="meal-plan-body">
                      <div class="meal-item">
                        <span class="meal-time">Breakfast</span>
                        <div class="meal-name">
                          <h6 class="mb-1">Avocado Toast with Poached Eggs</h6>
                          <p class="meal-calories mb-0">450 kcal | 25g Protein | 35g Carbs | 22g Fat</p>
                        </div>
                        <button class="btn btn-sm btn-outline-primary">View Recipe</button>
                      </div>
                      <div class="meal-item">
                        <span class="meal-time">Lunch</span>
                        <div class="meal-name">
                          <h6 class="mb-1">Grilled Chicken Salad</h6>
                          <p class="meal-calories mb-0">550 kcal | 42g Protein | 20g Carbs | 35g Fat</p>
                        </div>
                        <button class="btn btn-sm btn-outline-primary">View Recipe</button>
                      </div>
                      <div class="meal-item">
                        <span class="meal-time">Dinner</span>
                        <div class="meal-name">
                          <h6 class="mb-1">Salmon with Quinoa & Vegetables</h6>
                          <p class="meal-calories mb-0">600 kcal | 45g Protein | 40g Carbs | 28g Fat</p>
                        </div>
                        <button class="btn btn-sm btn-outline-primary">View Recipe</button>
                      </div>
                      
                      <div class="nutrition-facts mt-4">
                        <h6 class="mb-3">Daily Nutrition Summary</h6>
                        <div class="nutrition-item">
                          <span class="nutrition-label">Calories</span>
                          <span class="nutrition-value">2,100</span>
                        </div>
                        <div class="nutrition-item">
                          <span class="nutrition-label">Protein</span>
                          <span class="nutrition-value">112g</span>
                        </div>
                        <div class="nutrition-item">
                          <span class="nutrition-label">Carbs</span>
                          <span class="nutrition-value">95g</span>
                        </div>
                        <div class="nutrition-item">
                          <span class="nutrition-label">Fat</span>
                          <span class="nutrition-value">85g</span>
                        </div>
                        <div class="nutrition-item">
                          <span class="nutrition-label">Fiber</span>
                          <span class="nutrition-value">32g</span>
                        </div>
                      </div>
                      
                      <div class="meal-plan-actions">
                        <button class="btn btn-outline-secondary">
                          <i class="fas fa-sync-alt me-2"></i>Regenerate
                        </button>
                        <button class="btn btn-outline-primary">
                          <i class="fas fa-utensils me-2"></i>View Recipes
                        </button>
                        <button class="btn btn-primary ms-auto">
                          <i class="fas fa-shopping-basket me-2"></i>Add to Grocery List
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Portion Control Tab -->
        <div class="tab-pane fade" id="portions" role="tabpanel" aria-labelledby="portions-tab">
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body p-4">
              <h3 class="mb-4">Portion Control Guide</h3>
              <p class="text-muted mb-4">Customize your portion sizes based on your dietary needs and activity level. Adjust the sliders to see how portion sizes change.</p>
              
              <div class="row g-4">
                <div class="col-md-6">
                  <div class="mb-4">
                    <label class="form-label fw-medium">Number of People</label>
                    <div class="d-flex align-items-center">
                      <span class="me-2">1</span>
                      <input type="range" class="form-range" id="portionPeople" min="1" max="8" value="1">
                      <span class="ms-2" id="portionPeopleValue">1</span>
                    </div>
                  </div>
                  
                  <div class="mb-4">
                    <label class="form-label fw-medium">Activity Level</label>
                    <select class="form-select" id="activityLevel">
                      <option value="sedentary">Sedentary (little or no exercise)</option>
                      <option value="light">Lightly Active (light exercise 1-3 days/week)</option>
                      <option value="moderate" selected>Moderately Active (moderate exercise 3-5 days/week)</option>
                      <option value="active">Very Active (hard exercise 6-7 days/week)</option>
                      <option value="extreme">Extremely Active (very hard exercise & physical job)</option>
                    </select>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="mb-4">
                    <label class="form-label fw-medium">Dietary Goal</label>
                    <select class="form-select" id="dietaryGoal">
                      <option value="weight-loss">Weight Loss</option>
                      <option value="maintenance" selected>Weight Maintenance</option>
                      <option value="muscle-gain">Muscle Gain</option>
                    </select>
                  </div>
                  
                  <div class="mb-4">
                    <label class="form-label fw-medium">Meal Frequency</label>
                    <select class="form-select" id="mealFrequency">
                      <option value="3">3 Meals per day</option>
                      <option value="4">4 Meals per day</option>
                      <option value="5">5 Meals per day</option>
                      <option value="6">6 Meals per day</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <div class="alert alert-info mt-4">
                <i class="fas fa-info-circle me-2"></i>
                Adjust the settings above to see recommended portion sizes for your specific needs.
              </div>
            </div>
          </div>
          
          <div class="row align-items-center">
            <div class="col-lg-6">

              <div class="card mb-4">
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">Number of People</label>
                    <input type="range" class="form-range" id="portionPeople" min="1" max="10" value="2">
                    <div class="d-flex justify-content-between">
                      <small>1 person</small>
                      <span class="badge bg-primary rounded-pill px-3" id="portionPeopleValue">2 people</span>
                      <small>10 people</small>
                    </div>
                  </div>

                  <div class="mb-3">
                    <label class="form-label">Activity Level</label>
                    <select class="form-select" id="activityLevel">
                      <option value="sedentary">Sedentary (little or no exercise)</option>
                      <option value="light" selected>Lightly Active (light exercise 1-3 days/week)</option>
                      <option value="moderate">Moderately Active (moderate exercise 3-5 days/week)</option>
                      <option value="active">Very Active (hard exercise 6-7 days/week)</option>
                      <option value="extreme">Extremely Active (very hard exercise & physical job)</option>
                    </select>
                  </div>

                  <div class="mb-3">
                    <label class="form-label">Dietary Goal</label>
                    <select class="form-select" id="dietaryGoal">
                      <option value="maintain">Maintain Weight</option>
                      <option value="lose">Lose Weight</option>
                      <option value="gain">Gain Weight</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Nutritional Targets</h5>
                  <div class="row g-3">
                    <div class="col-6">
                      <div class="d-flex justify-content-between">
                        <span>Calories:</span>
                        <strong id="caloriesTarget">2,000</strong>
                      </div>
                      <div class="progress" style="height: 5px;">
                        <div class="progress-bar bg-success" style="width: 75%"></div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="d-flex justify-content-between">
                        <span>Protein:</span>
                        <strong id="proteinTarget">150g</strong>
                      </div>
                      <div class="progress" style="height: 5px;">
                        <div class="progress-bar bg-info" style="width: 85%"></div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="d-flex justify-content-between">
                        <span>Carbs:</span>
                        <strong id="carbsTarget">250g</strong>
                      </div>
                      <div class="progress" style="height: 5px;">
                        <div class="progress-bar bg-warning" style="width: 60%"></div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="d-flex justify-content-between">
                        <span>Fats:</span>
                        <strong id="fatsTarget">65g</strong>
                      </div>
                      <div class="progress" style="height: 5px;">
                        <div class="progress-bar bg-danger" style="width: 45%"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-6">
              <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                  <h4 class="mb-4">Recommended Portion Sizes</h4>
                  
                  <div class="portion-visualization">
                    <div class="portion-circle mx-auto mb-4">
                  <div class="portion-fill" id="portionFill"></div>
                  <div class="portion-text">
                    <span id="portionSize" class="d-block fs-4 fw-bold">Standard</span>
                    <span class="text-muted">Portion Size</span>
                  </div>
                </div>

                <div class="portion-details mt-4">
                  <div class="row g-3">
                    <div class="col-6">
                      <div class="card h-100">
                        <div class="card-body">
                          <div class="text-primary mb-2">
                            <i class="fas fa-utensils fa-2x"></i>
                          </div>
                          <h6>Meal Size</h6>
                          <p class="mb-0" id="mealSizeDetail">Standard adult portion</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="card h-100">
                        <div class="card-body">
                          <div class="text-success mb-2">
                            <i class="fas fa-fire fa-2x"></i>
                          </div>
                          <h6>Calories</h6>
                          <p class="mb-0" id="caloriesDetail">500-700 per meal</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="card h-100">
                        <div class="card-body">
                          <div class="text-info mb-2">
                            <i class="fas fa-drumstick-bite fa-2x"></i>
                          </div>
                          <h6>Protein</h6>
                          <p class="mb-0" id="proteinDetail">25-35g per meal</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="card h-100">
                        <div class="card-body">
                          <div class="text-warning mb-2">
                            <i class="fas fa-bread-slice fa-2x"></i>
                          </div>
                          <h6>Carbs</h6>
                          <p class="mb-0" id="carbsDetail">45-60g per meal</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mt-4">
                  <button class="btn btn-primary" id="applyPortionSettings">
                    <i class="fas fa-check-circle me-2"></i>Apply to Meal Plan
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recipe Swaps Tab -->
        <div class="tab-pane fade" id="recipe-swaps" role="tabpanel" aria-labelledby="swaps-tab">
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body p-4">
              <h3 class="mb-4">Find Recipe Alternatives</h3>
              <p class="text-muted mb-4">Search for recipe alternatives based on your dietary preferences or ingredient availability.</p>
              
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="input-group">
                    <span class="input-group-text bg-white"><i class="fas fa-search text-muted"></i></span>
                    <input type="text" class="form-control form-control-lg" id="recipeSearch" placeholder="Search for a recipe or ingredient...">
                    <button class="btn btn-primary" type="button">Search</button>
                  </div>
                </div>
                <div class="col-md-3">
                  <select class="form-select form-select-lg" id="dietaryPreference">
                    <option value="">All Diets</option>
                    <option value="vegetarian">Vegetarian</option>
                    <option value="vegan">Vegan</option>
                    <option value="keto">Keto</option>
                    <option value="gluten-free">Gluten-Free</option>
                    <option value="dairy-free">Dairy-Free</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <select class="form-select form-select-lg" id="cookingTime">
                    <option value="">Any Time</option>
                    <option value="15">Under 15 mins</option>
                    <option value="30">Under 30 mins</option>
                    <option value="45">Under 45 mins</option>
                    <option value="60">Under 1 hour</option>
                  </select>
                </div>
              </div>
              
              <div class="mt-4">
                <h5 class="mb-3">Popular Swaps</h5>
                <div class="row g-3" id="popularSwaps">
                  <!-- Popular swaps will be loaded here -->
                  <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                          <h6 class="mb-0">Pasta</h6>
                          <span class="badge bg-light text-dark">Carbs</span>
                        </div>
                        <p class="small text-muted mb-3">Try zucchini noodles or spaghetti squash instead of traditional pasta</p>
                        <button class="btn btn-sm btn-outline-primary w-100">View Alternatives</button>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                          <h6 class="mb-0">Rice</h6>
                          <span class="badge bg-light text-dark">Carbs</span>
                        </div>
                        <p class="small text-muted mb-3">Try cauliflower rice or quinoa for a lower-carb option</p>
                        <button class="btn btn-sm btn-outline-primary w-100">View Alternatives</button>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                          <h6 class="mb-0">Milk</h6>
                          <span class="badge bg-light text-dark">Dairy</span>
                        </div>
                        <p class="small text-muted mb-3">Try almond, oat, or soy milk as dairy alternatives</p>
                        <button class="btn btn-sm btn-outline-primary w-100">View Alternatives</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="row mb-4">
            <div class="col-md-8 mx-auto text-center">
              <h4>Find Recipe Alternatives</h4>
              <p class="text-muted">Looking for something different? Swap any recipe in your meal plan with a suitable
                alternative.</p>
              <div class="input-group mb-3">
                <input type="text" class="form-control" placeholder="Search for recipes..." id="recipeSearch">
                <button class="btn btn-primary" type="button" id="searchRecipes">
                  <i class="fas fa-search me-1"></i>Search
                </button>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="dietaryFilter" checked>
                <label class="form-check-label" for="dietaryFilter">Match my dietary preferences</label>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-5">
              <div class="card h-100">
                <div class="card-header bg-light">
                  <h5 class="mb-0">Current Recipe</h5>
                </div>
                <div class="card-body text-center" id="currentRecipe">
                  <div class="py-4">
                    <i class="fas fa-utensils fa-3x text-muted mb-3"></i>
                    <h5>Select a recipe to swap</h5>
                    <p class="text-muted mb-0">Choose a recipe from your meal plan or search above</p>
                  </div>
                </div>
                <div class="card-footer bg-transparent">
                  <small class="text-muted">Select a recipe to see alternatives</small>
                </div>
              </div>
            </div>

            <div class="col-md-2 d-flex align-items-center justify-content-center my-4 my-md-0">
              <div class="text-center">
                <i class="fas fa-exchange-alt fa-2x text-muted d-block mb-2"></i>
                <span class="badge bg-primary rounded-pill px-3 py-1">SWAP</span>
              </div>
            </div>

            <div class="col-md-5">
              <div class="card h-100">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                  <h5 class="mb-0">Suggested Alternatives</h5>
                  <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="sortOptions"
                      data-bs-toggle="dropdown">
                      <i class="fas fa-sort me-1"></i>Sort by
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                      <li><a class="dropdown-item sort-option active" href="#" data-sort="relevance">Relevance</a></li>
                      <li><a class="dropdown-item sort-option" href="#" data-sort="calories">Calories</a></li>
                      <li><a class="dropdown-item sort-option" href="#" data-sort="prep-time">Prep Time</a></li>
                      <li><a class="dropdown-item sort-option" href="#" data-sort="rating">Rating</a></li>
                    </ul>
                  </div>
                </div>
                <div class="card-body p-0" id="suggestedRecipe">
                  <div class="suggestions-placeholder p-4 text-center">
                    <i class="fas fa-lightbulb fa-3x text-warning mb-3"></i>
                    <h5>Recipe Suggestions</h5>
                    <p class="text-muted">Select a recipe to see alternative options that match your preferences.</p>
                  </div>
                  <div class="suggestions-list" style="max-height: 400px; overflow-y: auto; display: none;">
                    <!-- Suggested recipes will be loaded here -->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-4">
            <h5 class="mb-3">Popular Recipe Swaps</h5>
            <div class="row g-3" id="popularSwaps">
              <!-- Popular swaps will be loaded here -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Budget Tracking -->
  <section class="section" id="budget-tracking">
    <div class="container">
      <h2 class="section-title text-center mb-5">Smart Budget Tracking</h2>

      <div class="row g-4">
        <!-- Budget Overview Card -->
        <div class="col-lg-4">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
              <h4 class="card-title"><i class="fas fa-wallet text-primary me-2"></i>Monthly Budget</h4>
              <div class="budget-form mb-4">
                <div class="input-group mb-3">
                  <span class="input-group-text">KES</span>
                  <input type="number" id="monthly-budget" class="form-control" placeholder="Enter monthly budget"
                    value="20000">
                  <button class="btn btn-primary" id="update-budget">Update</button>
                </div>
              </div>
              <div class="budget-summary text-center">
                <div class="display-4 fw-bold text-primary mb-2" id="budget-remaining">KES 7,000</div>
                <div class="text-muted mb-3">remaining of <span id="total-budget">KES 20,000</span></div>
                <div class="progress mb-2" style="height: 10px;">
                  <div id="budget-progress" class="progress-bar bg-success" role="progressbar" style="width: 65%;"
                    aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="small text-muted">Spent: <span id="amount-spent">KES 13,000</span> (65%)</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Spending by Category -->
        <div class="col-lg-8">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="card-title mb-0"><i class="fas fa-chart-pie text-primary me-2"></i>Spending by Category</h4>
                <button class="btn btn-sm btn-outline-primary" id="add-expense">
                  <i class="fas fa-plus me-1"></i> Add Expense
                </button>
              </div>

              <div class="row g-3 mb-4">
                <div class="col-md-6">
                  <div class="category-spending">
                    <div class="d-flex justify-content-between mb-2">
                      <span>Groceries</span>
                      <span class="fw-bold">KES 8,500</span>
                    </div>
                    <div class="progress mb-3" style="height: 8px;">
                      <div class="progress-bar bg-success" style="width: 70%;"></div>
                    </div>
                  </div>
                  <div class="category-spending">
                    <div class="d-flex justify-content-between mb-2">
                      <span>Dining Out</span>
                      <span class="fw-bold">KES 3,200</span>
                    </div>
                    <div class="progress mb-3" style="height: 8px;">
                      <div class="progress-bar bg-info" style="width: 40%;"></div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="category-spending">
                    <div class="d-flex justify-content-between mb-2">
                      <span>Snacks</span>
                      <span class="fw-bold">KES 1,300</span>
                    </div>
                    <div class="progress mb-3" style="height: 8px;">
                      <div class="progress-bar bg-warning" style="width: 25%;"></div>
                    </div>
                  </div>
                  <div class="category-spending">
                    <div class="d-flex justify-content-between mb-2">
                      <span>Beverages</span>
                      <span class="fw-bold">KES 2,000</span>
                    </div>
                    <div class="progress mb-3" style="height: 8px;">
                      <div class="progress-bar bg-danger" style="width: 35%;"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recent Transactions -->
              <div class="recent-transactions">
                <h5 class="mb-3"><i class="fas fa-history text-muted me-2"></i>Recent Transactions</h5>
                <div class="list-group list-group-flush">
                  <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                    <div>
                      <h6 class="mb-0">Nakumatt Supermarket</h6>
                      <small class="text-muted">Groceries • Today</small>
                    </div>
                    <span class="fw-bold text-danger">- KES 2,450</span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                    <div>
                      <h6 class="mb-0">Artcaffé</h6>
                      <small class="text-muted">Dining Out • Yesterday</small>
                    </div>
                    <span class="fw-bold text-danger">- KES 1,850</span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                    <div>
                      <h6 class="mb-0">Naivas Supermarket</h6>
                      <small class="text-muted">Groceries • 2 days ago</small>
                    </div>
                    <span class="fw-bold text-danger">- KES 3,200</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Budget Tips & Alerts -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <i class="fas fa-lightbulb text-warning me-2 fs-4"></i>
                <h5 class="mb-0">Budgeting Tips</h5>
              </div>
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="d-flex">
                    <div class="me-3 text-primary">
                      <i class="fas fa-percentage fa-2x"></i>
                    </div>
                    <div>
                      <h6>Track Your Spending</h6>
                      <p class="small text-muted mb-0">Log every expense to see where your money goes each month.</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="d-flex">
                    <div class="me-3 text-primary">
                      <i class="fas fa-tags fa-2x"></i>
                    </div>
                    <div>
                      <h6>Use Categories</h6>
                      <p class="small text-muted mb-0">Categorize expenses to identify spending patterns.</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="d-flex">
                    <div class="me-3 text-primary">
                      <i class="fas fa-bullseye fa-2x"></i>
                    </div>
                    <div>
                      <h6>Set Realistic Goals</h6>
                      <p class="small text-muted mb-0">Aim to save 10-20% of your income each month.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>



  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Plexus Care</h3>
          <p>Smart meal planning and nutrition tracking for a healthier you.</p>
        </div>
        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#meal-planner">Meal Planner</a></li>
            <li><a href="#diet-tracker">Diet Tracker</a></li>
            <li><a href="#shop">Grocery Shopping</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Contact Us</h4>
          <p>Email: info@plexuscare.com</p>
          <p>Phone: +254 700 123456</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2023 Plexus Care. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="js/config.js"></script>
  <script src="https://unpkg.com/intasend-inlinejs-sdk@4.0.7/build/intasend-inline.js"></script>

  <script>


    // Define meal suggestions for different meal types
    const mealsByType = {
      breakfast: [
        {
          name: 'Millet Porridge with Dates & Groundnuts',
          recipe: 'Ingredients: millet flour, water, chopped dates, groundnuts.',
          instructions: 'Whisk millet flour with water over low heat until smooth; top with dates and groundnuts for energy and iron.',
          image: 'assets/images/meal-planner.png',
          price: 50
        },
        {
          name: 'Oatmeal with Banana & Moringa',
          recipe: 'Ingredients: rolled oats, milk or water, banana slices, a pinch of moringa powder.',
          instructions: 'Cook oats until creamy; stir in banana slices and sprinkle moringa powder for added vitamins.',
          image: 'assets/images/meal-planner.png',
          price: 70
        },
        {
          name: 'Mandazi with Fresh Fruit Salad',
          recipe: 'Ingredients: mandazi, assorted fresh fruits, honey.',
          instructions: 'Serve warm mandazi with a bowl of fresh fruit salad drizzled with honey for an energizing start to your day.',
          image: 'assets/images/meal-planner.png',
          price: 80
        },
        {
          name: 'Sweet Potato Pancakes with Honey',
          recipe: 'Ingredients: mashed sweet potatoes, flour, eggs, milk, honey, baking powder.',
          instructions: 'Mix all ingredients to form a batter. Cook on a hot griddle until golden brown. Drizzle with honey before serving.',
          image: 'assets/images/meal-planner.png',
          price: 90
        },
        {
          name: 'Avocado & Egg Toast',
          recipe: 'Ingredients: whole grain bread, ripe avocado, eggs, chili flakes, salt, pepper.',
          instructions: 'Toast bread, spread mashed avocado, top with poached or fried eggs. Season with chili flakes, salt, and pepper.',
          image: 'assets/images/meal-planner.png',
          price: 120
        },
        {
          name: 'Coconut Rice Porridge with Mango',
          recipe: 'Ingredients: rice, coconut milk, water, sugar, ripe mango, cinnamon.',
          instructions: 'Cook rice in coconut milk and water until soft. Sweeten to taste. Serve with fresh mango slices and a sprinkle of cinnamon.',
          image: 'assets/images/meal-planner.png',
          price: 85
        },
        {
          name: 'African Tea with Bhajia',
          recipe: 'Ingredients: black tea leaves, milk, ginger, sugar, potatoes, gram flour, spices.',
          instructions: 'Brew strong tea with ginger and milk. Make potato bhajias by deep-frying spiced gram flour-coated potato slices. Serve together.',
          image: 'assets/images/meal-planner.png',
          price: 100
        },
        {
          name: 'Scrambled Eggs with Sukuma Wiki',
          recipe: 'Ingredients: eggs, sukuma wiki (kale), tomatoes, onions, cooking oil, salt, pepper.',
          instructions: 'Sauté onions and tomatoes, add chopped sukuma wiki, then pour in beaten eggs. Scramble until cooked through. Season to taste.',
          image: 'assets/images/meal-planner.png',
          price: 110
        }
      ],
      lunch: [
        {
          name: 'Githeri with Sautéed Spinach & Avocado',
          recipe: 'Ingredients: boiled maize and beans, fresh spinach, avocado, lemon juice.',
          instructions: 'Lightly sauté spinach and mix with githeri; serve with diced avocado and a squeeze of lemon for vitamin C.',
          image: 'assets/images/meal-planner.png',
          price: 120
        },
        {
          name: 'Vegetable Stew with Brown Rice',
          recipe: 'Ingredients: a mix of local vegetables (e.g., carrots, kale, tomatoes), spices, brown rice.',
          instructions: 'Stew vegetables until tender and serve over brown rice to provide essential fiber and nutrients.',
          image: 'assets/images/meal-planner.png',
          price: 150
        },
        {
          name: 'Ugali with Sukuma Wiki and Grilled Chicken',
          recipe: 'Ingredients: maize flour, water, fresh sukuma wiki, grilled chicken, spices.',
          instructions: 'Prepare ugali with maize flour and water; sauté sukuma wiki with spices and serve alongside slices of grilled chicken for a balanced meal.',
          image: 'assets/images/meal-planner.png',
          price: 180
        },
        {
          name: 'Chapati with Bean Stew',
          recipe: 'Ingredients: chapati, beans, tomatoes, onions, spices.',
          instructions: 'Slowly simmer beans with tomatoes, onions, and spices; serve with warm chapati for a filling and nutritious lunch.',
          image: 'assets/images/meal-planner.png',
          price: 100
        },
        {
          name: 'Mukimo with Grilled Tilapia',
          recipe: 'Ingredients: potatoes, green peas, maize, spinach, onions, tilapia, lemon, spices.',
          instructions: 'Prepare mukimo by mashing cooked potatoes, peas, maize, and spinach. Season and grill tilapia with lemon. Serve together.',
          image: 'assets/images/meal-planner.png',
          price: 200
        },
        {
          name: 'Wali wa Nazi na Mchuzi wa Samaki',
          recipe: 'Ingredients: rice, coconut milk, fish, tomatoes, onions, garlic, ginger, spices.',
          instructions: 'Cook rice in coconut milk. Prepare fish stew with tomatoes, onions, and spices. Serve the coconut rice with fish stew on top.',
          image: 'assets/images/meal-planner.png',
          price: 220
        },
        {
          name: 'Matoke with Beef Stew',
          recipe: 'Ingredients: green bananas, beef, tomatoes, onions, garlic, ginger, spices.',
          instructions: 'Steam green bananas until tender. Prepare beef stew with tomatoes, onions, and spices. Serve matoke with the beef stew.',
          image: 'assets/images/meal-planner.png',
          price: 190
        },
        {
          name: 'Kachumbari with Grilled Chicken',
          recipe: 'Ingredients: tomatoes, onions, chili, lemon, coriander, chicken, spices.',
          instructions: 'Prepare kachumbari by mixing diced tomatoes, onions, chili, lemon juice, and coriander. Season and grill chicken. Serve together.',
          image: 'assets/images/meal-planner.png',
          price: 210
        },
        {
          name: 'Maharagwe na Wali',
          recipe: 'Ingredients: kidney beans, coconut milk, rice, onions, garlic, ginger, spices.',
          instructions: 'Cook beans until tender, then simmer with coconut milk and spices. Serve with steamed rice.',
          image: 'assets/images/meal-planner.png',
          price: 130
        },
        {
          name: 'Samosas with Tamarind Chutney',
          recipe: 'Ingredients: samosa pastry, spiced potato and pea filling, tamarind, sugar, spices.',
          instructions: 'Fill samosa pastry with spiced potato and pea mixture, fold into triangles, and deep fry. Serve with sweet tamarind chutney.',
          image: 'assets/images/meal-planner.png',
          price: 150
        }
      ],
      dinner: [
        {
          name: 'Grilled Tilapia with Sweet Potato & Sukuma Wiki',
          recipe: 'Ingredients: tilapia (low-mercury fish), sweet potato, sukuma wiki, spices.',
          instructions: 'Season and grill tilapia; boil sweet potatoes and sauté sukuma wiki; serve together for a balanced dinner rich in omega-3 and vitamins.',
          image: 'assets/images/meal-planner.png',
          price: 200
        },
        {
          name: 'Chicken & Lentil Stew with Ugali',
          recipe: 'Ingredients: lean chicken, lentils, tomatoes, onions, maize flour.',
          instructions: 'Prepare a hearty stew with chicken and lentils for protein and fiber; serve with soft ugali.',
          image: 'assets/images/meal-planner.png',
          price: 220
        },
        {
          name: 'Vegetable Pilau with Mixed Beans',
          recipe: 'Ingredients: basmati rice, mixed vegetables, beans, pilau spices, broth.',
          instructions: 'Sauté vegetables with pilau spices, add rice and beans, then simmer in broth until cooked. Serve warm for a comforting dinner.',
          image: 'assets/images/meal-planner.png',
          price: 180
        },
        {
          name: 'Kenyan Beef Stew with Rice',
          recipe: 'Ingredients: beef, potatoes, carrots, onions, spices, rice.',
          instructions: 'Slowly cook beef with vegetables until tender; serve hot over steamed rice for a hearty and nutritious meal.',
          image: 'assets/images/meal-planner.png',
          price: 250
        },
        {
          name: 'Fish Curry with Coconut Rice',
          recipe: 'Ingredients: white fish fillets, coconut milk, rice, curry spices, vegetables.',
          instructions: 'Prepare a fragrant fish curry with coconut milk and serve with coconut-infused rice for a tropical twist.',
          image: 'assets/images/meal-planner.png',
          price: 230
        },
        {
          name: 'Chicken Biryani with Raita',
          recipe: 'Ingredients: basmati rice, chicken, yogurt, biryani spices, onions, tomatoes.',
          instructions: 'Layer marinated chicken with partially cooked rice and steam together. Serve with cooling cucumber raita.',
          image: 'assets/images/meal-planner.png',
          price: 270
        },
        {
          name: 'Lentil Soup with Fresh Bread',
          recipe: 'Ingredients: red lentils, carrots, onions, garlic, vegetable stock, bread.',
          instructions: 'Simmer lentils with vegetables and spices until tender. Blend until smooth and serve with crusty bread.',
          image: 'assets/images/meal-planner.png',
          price: 150
        },
        {
          name: 'Stuffed Bell Peppers with Quinoa',
          recipe: 'Ingredients: bell peppers, quinoa, black beans, corn, cheese, spices.',
          instructions: 'Stuff bell peppers with a mixture of cooked quinoa, black beans, corn, and cheese. Bake until peppers are tender.',
          image: 'assets/images/meal-planner.png',
          price: 190
        },
        {
          name: 'Beef Meatballs with Spaghetti',
          recipe: 'Ingredients: ground beef, breadcrumbs, egg, spaghetti, tomato sauce, herbs.',
          instructions: 'Mix beef with breadcrumbs and egg to form meatballs. Bake and serve with spaghetti and tomato sauce.',
          image: 'assets/images/meal-planner.png',
          price: 240
        },
        {
          name: 'Vegetable Stir-fry with Noodles',
          recipe: 'Ingredients: mixed vegetables, egg noodles, soy sauce, garlic, ginger, sesame oil.',
          instructions: 'Stir-fry vegetables with garlic and ginger, add cooked noodles and sauce. Toss to combine and serve hot.',
          image: 'assets/images/meal-planner.png',
          price: 170
        }
      ],
      snack: [
        {
          name: 'Fruit Smoothie with Yogurt',
          recipe: 'Ingredients: mixed fruits (banana, mango, berries), yogurt, honey, ice cubes.',
          instructions: 'Blend all ingredients until smooth for a refreshing and nutritious snack.',
          image: 'assets/images/meal-planner.png',
          price: 80
        },
        {
          name: 'Roasted Maize (Mahindi Choma)',
          recipe: 'Ingredients: fresh maize, lemon, chili powder, salt.',
          instructions: 'Roast maize until golden brown; serve with lemon wedges and a sprinkle of chili powder and salt.',
          image: 'assets/images/meal-planner.png',
          price: 30
        },
        {
          name: 'Boiled Sweet Potatoes with Peanut Butter',
          recipe: 'Ingredients: sweet potatoes, natural peanut butter, salt.',
          instructions: 'Boil sweet potatoes until tender; serve with a side of peanut butter for dipping.',
          image: 'assets/images/meal-planner.png',
          price: 50
        },
        {
          name: 'Fruit Salad with Nuts',
          recipe: 'Ingredients: assorted seasonal fruits, mixed nuts, lime juice, honey.',
          instructions: 'Chop fruits into bite-sized pieces, mix with nuts, drizzle with lime juice and honey, and serve chilled.',
          image: 'assets/images/meal-planner.png',
          price: 100
        },
        {
          name: 'Bhajia with Tamarind Sauce',
          recipe: 'Ingredients: potatoes, gram flour, spices, tamarind, sugar, chili.',
          instructions: 'Slice potatoes, dip in spiced gram flour batter, and deep fry until golden. Serve with sweet and spicy tamarind sauce.',
          image: 'assets/images/meal-planner.png',
          price: 60
        },
        {
          name: 'Roasted Nuts and Dried Fruit Mix',
          recipe: 'Ingredients: mixed nuts (almonds, cashews, peanuts), dried fruits (raisins, mango, pineapple), spices.',
          instructions: 'Toss nuts with spices and roast until golden. Mix with dried fruits and store in an airtight container.',
          image: 'assets/images/meal-planner.png',
          price: 120
        },
        {
          name: 'Avocado Toast with Chili Flakes',
          recipe: 'Ingredients: whole grain bread, ripe avocado, chili flakes, salt, lemon juice.',
          instructions: 'Toast bread, spread mashed avocado, and sprinkle with chili flakes, salt, and a squeeze of lemon.',
          image: 'assets/images/meal-planner.png',
          price: 90
        },
        {
          name: 'Plantain Chips with Guacamole',
          recipe: 'Ingredients: ripe plantains, avocado, tomato, onion, lime, spices, oil for frying.',
          instructions: 'Slice plantains thinly and fry until crispy. Make guacamole by mashing avocado with diced tomatoes, onions, lime juice, and spices.',
          image: 'assets/images/meal-planner.png',
          price: 110
        },
        {
          name: 'Yogurt with Honey and Granola',
          recipe: 'Ingredients: plain yogurt, honey, granola, fresh berries.',
          instructions: 'Layer yogurt with granola and fresh berries. Drizzle with honey before serving.',
          image: 'assets/images/meal-planner.png',
          price: 95
        },
        {
          name: 'Sweet Corn and Pea Samosas',
          recipe: 'Ingredients: samosa pastry, sweet corn, green peas, potatoes, spices.',
          instructions: 'Fill samosa pastry with spiced sweet corn, peas, and potato mixture. Fold and deep fry until golden brown.',
          image: 'assets/images/meal-planner.png',
          price: 70
        }
      ]
    };

    // Sample meal database
    const mealDatabase = {
      breakfast: [
        { id: 'bf1', name: 'Mandazi & Tea', price: 150, calories: 320, protein: 8, carbs: 45, fat: 12, ingredients: ['Wheat flour', 'Sugar', 'Yeast', 'Coconut milk', 'Tea leaves', 'Milk'], instructions: 'Mix flour, sugar, yeast, and coconut milk to form a dough. Let it rise, then roll and cut into triangles. Deep fry until golden brown. Serve with hot tea.' },
        { id: 'bf2', name: 'Oatmeal with Fruits', price: 200, calories: 280, protein: 10, carbs: 50, fat: 5, ingredients: ['Oats', 'Milk', 'Banana', 'Honey', 'Cinnamon'], instructions: 'Cook oats with milk until creamy. Top with sliced banana, a drizzle of honey, and a sprinkle of cinnamon.' }
      ],
      lunch: [
        { id: 'ln1', name: 'Ugali & Sukuma Wiki', price: 250, calories: 450, protein: 15, carbs: 70, fat: 10, ingredients: ['Maize flour', 'Sukuma wiki', 'Tomatoes', 'Onions', 'Cooking oil', 'Salt'], instructions: 'Prepare stiff porridge with maize flour. Sauté onions, tomatoes, and sukuma wiki with oil. Serve hot with ugali.' },
        { id: 'ln2', name: 'Rice & Beans', price: 300, calories: 500, protein: 18, carbs: 85, fat: 8, ingredients: ['Rice', 'Beans', 'Onions', 'Tomatoes', 'Garlic', 'Ginger', 'Coconut milk'], instructions: 'Cook beans until tender. Sauté onions, garlic, and ginger. Add tomatoes and coconut milk. Mix with cooked rice and beans.' }
      ],
      dinner: [
        { id: 'dn1', name: 'Chapati & Beef Stew', price: 350, calories: 600, protein: 30, carbs: 60, fat: 25, ingredients: ['Wheat flour', 'Beef', 'Tomatoes', 'Onions', 'Garlic', 'Ginger', 'Spices'], instructions: 'Prepare chapati dough and roll into circles. Cook on a hot pan. For the stew, brown beef with onions, then add tomatoes and spices. Simmer until tender.' },
        { id: 'dn2', name: 'Fish & Ugali', price: 400, calories: 550, protein: 35, carbs: 65, fat: 15, ingredients: ['Tilapia fish', 'Maize flour', 'Tomatoes', 'Onions', 'Coriander', 'Lemon'], instructions: 'Marinate fish with lemon and spices. Grill or fry until cooked. Prepare ugali and serve with the fish and kachumbari.' }
      ]
    };

    // App state
    let cart = [];
    let selectedDiet = 'anything';
    let avoidedFoods = [];
    let currentTab = 'meal-planner';

    // DOM refs used in multiple places (may be null if elements not present)
    const mealResults = document.getElementById('mealResults');
    const cartItems = document.getElementById('cartItems');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');
    const deliveryFeeEl = document.getElementById('deliveryFee');
    const nutritionTargets = document.getElementById('nutritionTargets');

    // -------------------------
    // Initialization
    // -------------------------
    // Function to check if budget is realistic for number of people
    function isBudgetRealistic(budget, people) {
      // Minimum 100 KES per person is considered realistic
      return budget >= (people * 100);
    }

    // Function to generate meal suggestions based on user input
    function generateMealSuggestions() {
      const mealType = document.getElementById('mealType').value;
      const budget = parseInt(document.getElementById('budget').value) || 500; // Default to 500 KES if not provided
      const people = parseInt(document.getElementById('people').value) || 1;
      const mealResults = document.getElementById('mealResults');
      const budgetWarning = document.getElementById('budgetWarning');

      // Reset warning
      budgetWarning.classList.add('d-none');

      if (!mealType) {
        showNotification('Please select a meal type.', 'warning');
        return;
      }

      // Validate number of people
      if (people > 10) {
        showNotification('Maximum of 10 people per order. Please adjust your selection.', 'warning');
        document.getElementById('people').value = 10;
        return;
      }

      // Check if budget is realistic
      if (!isBudgetRealistic(budget, people)) {
        budgetWarning.classList.remove('d-none');
      }

      // Show the results section
      mealResults.classList.remove('hidden');

      // Clear previous results
      mealResults.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Meal Suggestions</h3>
          <div class="text-muted">
            <span class="badge bg-primary">${people} ${people === 1 ? 'Person' : 'People'}</span>
            <span class="badge bg-success ms-2">Budget: KES ${budget}</span>
          </div>
        </div>
        <div class="row" id="mealCards"></div>`;

      const mealCards = document.getElementById('mealCards');

      // Get meals for the selected type and filter by budget
      let selectedMeals = [];

      if (mealType === 'all') {
        // Combine all meal types
        Object.values(mealsByType).forEach(meals => {
          selectedMeals = [...selectedMeals, ...meals];
        });
      } else {
        selectedMeals = [...mealsByType[mealType] || []];
      }

      // Filter meals by budget (per person)
      const minBudgetPerPerson = 80; // Minimum realistic price per person in KES
      const maxPricePerMeal = budget / people;

      // Show warning if budget is too low
      if (maxPricePerMeal < minBudgetPerPerson) {
        budgetWarning.classList.remove('d-none');
      }

      const filteredMeals = selectedMeals.filter(meal => meal.price <= maxPricePerMeal);

      if (filteredMeals.length === 0) {
        mealCards.innerHTML = `
          <div class="col-12">
            <div class="alert alert-warning">
              <h5><i class="fas fa-utensils me-2"></i>No meals found within your budget</h5>
              <p class="mb-0">
                Your budget of KES ${budget} (${people > 1 ? `KES ${Math.round(budget / people)} per person` : 'for 1 person'}) 
                is too low for the selected meal type. Try increasing your budget or selecting a different meal category.
              </p>
            </div>
          </div>`;
        return;
      }

      // Display the filtered meals
      filteredMeals.forEach(meal => {
        const totalPrice = meal.price * people;
        const cardDiv = document.createElement('div');
        cardDiv.className = 'col-md-6 col-lg-4 mb-4 fadeIn';
        cardDiv.innerHTML = `
          <div class="card h-100 shadow-sm">
            <img src="${meal.image}" class="card-img-top meal-image" alt="${meal.name}" style="height: 200px; object-fit: cover;">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${meal.name}</h5>
              <p class="card-text text-muted">
                <i class="fas fa-tag"></i> KES ${meal.price} per serving
                ${people > 1 ? `<br><small>Total for ${people}: KES ${totalPrice}</small>` : ''}
              </p>
              <p class="card-text"><small class="text-muted">${meal.recipe}</small></p>
              <button class="btn btn-outline-secondary toggle-instructions mt-auto">
                <i class="fas fa-utensils"></i> Show Cooking Instructions
              </button>
              <div class="meal-instructions hidden mt-3 p-3 bg-light rounded">
                <h6><i class="fas fa-list-ol"></i> Instructions:</h6>
                <p class="mb-0">${meal.instructions}</p>
              </div>
            </div>
          </div>`;
        mealCards.appendChild(cardDiv);
      });
    }

    // Toggle cooking instructions
    document.addEventListener('click', function (e) {
      if (e.target && e.target.classList.contains('toggle-instructions')) {
        const instructions = e.target.nextElementSibling;
        instructions.classList.toggle('hidden');
        const icon = e.target.querySelector('i.fas') || e.target;
        if (instructions.classList.contains('hidden')) {
          icon.className = 'fas fa-utensils';
          e.target.innerHTML = '<i class="fas fa-utensils"></i> Show Cooking Instructions';
        } else {
          icon.className = 'fas fa-times';
          e.target.innerHTML = '<i class="fas fa-times"></i> Hide Instructions';
        }
      }
    });

    // Update form submission to use the new function
    document.getElementById('mealPlannerForm').addEventListener('submit', function (e) {
      e.preventDefault();
      generateMealSuggestions();
    });

    document.addEventListener('DOMContentLoaded', () => {
      setupTabNavigation();

      // Initialize form with default values
      document.getElementById('budget').value = '150'; // Default budget to 150 KES
      document.getElementById('people').value = '1';   // Default to 1 person

      // diet selection
      document.querySelectorAll('.diet-card[data-diet]').forEach(card => {
        card.addEventListener('click', () => {
          document.querySelectorAll('.diet-card[data-diet]').forEach(c => c.classList.remove('active'));
          card.classList.add('active');
          selectedDiet = card.getAttribute('data-diet');
        });
      });

      // food avoidance
      document.querySelectorAll('.diet-card[data-avoid]').forEach(card => {
        card.addEventListener('click', () => {
          card.classList.toggle('active');
          const food = card.getAttribute('data-avoid');
          if (card.classList.contains('active')) {
            if (!avoidedFoods.includes(food)) avoidedFoods.push(food);
          } else {
            avoidedFoods = avoidedFoods.filter(f => f !== food);
          }
        });
      });

      // form submit
      const personalInfoForm = document.getElementById('personalInfoForm');
      if (personalInfoForm) {
        personalInfoForm.addEventListener('submit', (e) => {
          e.preventDefault();
          calculateNutritionNeeds();
        });
      }

      // generate meals
      const generateMealsBtn = document.querySelector('button[onclick="generateMeals()"]');
      if (generateMealsBtn) generateMealsBtn.addEventListener('click', generateMeals);

      // start trial
      const startTrialBtn = document.getElementById('startTrialBtn');
      if (startTrialBtn) startTrialBtn.addEventListener('click', () => showNotification('Starting your 14-day free trial!'));

      // radio groups
      document.querySelectorAll('.radio-option').forEach(option => {
        option.addEventListener('click', () => {
          const group = option.closest('.radio-group');
          group.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('active'));
          option.classList.add('active');
          const input = option.querySelector('input');
          if (input) input.checked = true;
        });
      });

      // Initialize grocery section
      if (document.getElementById('grocery-items')) {
        initGrocerySection();
      }

      // Initialize budget tracking if on budget page
      if (document.getElementById('budget-tracking')) {
        initBudgetTracking();
      }

      // Initialize first tab
      showTab('meal-planner');
    });

    // -------------------------
    // Tabs
    // -------------------------
    function setupTabNavigation() {
      document.querySelectorAll('.tab-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const tabId = link.getAttribute('data-tab');
          showTab(tabId);
        });
      });
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
      document.querySelectorAll('.tab-link').forEach(link => link.classList.remove('active'));
      const activeTab = document.getElementById(tabId);
      if (activeTab) activeTab.style.display = 'block';
      const activeLink = document.querySelector(`.tab-link[data-tab="${tabId}"]`);
      if (activeLink) activeLink.classList.add('active');
      currentTab = tabId;
    }

    // -------------------------
    // Meal planner functions
    // -------------------------
    function generateMeals() {
      const mealType = document.getElementById('mealType')?.value || 'all';
      const people = parseInt(document.getElementById('people')?.value) || 1;
      const budget = parseInt(document.getElementById('budget')?.value) || 1000;
      const cuisine = document.getElementById('cuisine')?.value || 'any';

      let meals = [];
      if (mealType === 'all') {
        Object.values(mealDatabase).forEach(category => meals = [...meals, ...category]);
      } else if (mealDatabase[mealType]) {
        meals = [...mealDatabase[mealType]];
      }

      if (cuisine && cuisine !== 'any') {
        meals = meals.filter(meal => meal.name.toLowerCase().includes(cuisine.toLowerCase()) || meal.ingredients.some(ing => ing.toLowerCase().includes(cuisine.toLowerCase())));
      }

      const budgetPerMeal = budget / (people * 3);
      meals = meals.filter(meal => meal.price <= budgetPerMeal);

      if (selectedDiet !== 'anything') {
        meals = meals.filter(meal => {
          if (selectedDiet === 'vegetarian') {
            return !meal.ingredients.some(ing => ['beef', 'chicken', 'fish', 'meat', 'pork'].some(non => ing.toLowerCase().includes(non)));
          } else if (selectedDiet === 'vegan') {
            return !meal.ingredients.some(ing => ['beef', 'chicken', 'fish', 'meat', 'pork', 'milk', 'cheese', 'yogurt', 'honey'].some(non => ing.toLowerCase().includes(non)));
          } else if (selectedDiet === 'keto') {
            return meal.carbs < 20;
          }
          return true;
        });
      }

      if (avoidedFoods.length > 0) {
        meals = meals.filter(meal => !meal.ingredients.some(ing => avoidedFoods.some(a => ing.toLowerCase().includes(a.toLowerCase()))));
      }

      displayMeals(meals.slice(0, 6));
    }

    function displayMeals(meals) {
      const container = document.getElementById('mealResults');
      if (!container) return;

      container.innerHTML = '';
      container.classList.remove('hidden');

      if (meals.length === 0) {
        container.innerHTML = '<p class="text-center">No meals found matching your criteria. Try adjusting your filters.</p>';
        return;
      }

      meals.forEach(meal => {
        const mealEl = document.createElement('div');
        mealEl.className = 'meal-card';
        mealEl.innerHTML = `
          <div class="meal-image">${meal.name.charAt(0)}</div>
          <div class="meal-content">
            <h3 class="meal-title">${meal.name}</h3>
            <div class="meal-details"><span class="meal-price">KES ${meal.price}</span><span class="meal-servings">${meal.calories} kcal</span></div>
            <div class="ingredients-list"><h4>Ingredients:</h4><p class="ingredients">${meal.ingredients.join(', ')}</p></div>
            <div class="meal-actions">
              <button class="btn btn-small view-recipe" data-meal-id="${meal.id}"><i class="fas fa-utensils"></i> View Recipe</button>
              <button class="btn btn-small btn-secondary add-to-cart" data-meal-id="${meal.id}"><i class="fas fa-cart-plus"></i> Add to Cart</button>
            </div>
          </div>`;
        container.appendChild(mealEl);
      });

      // listeners
      document.querySelectorAll('.view-recipe').forEach(btn => btn.addEventListener('click', e => {
        const mealId = e.target.closest('button').getAttribute('data-meal-id'); viewRecipe(mealId);
      }));
      document.querySelectorAll('.add-to-cart').forEach(btn => btn.addEventListener('click', e => {
        const mealId = e.target.closest('button').getAttribute('data-meal-id'); addToCart(mealId);
      }));
    }

    function viewRecipe(mealId) {
      let meal;
      Object.values(mealDatabase).some(cat => { const found = cat.find(m => m.id === mealId); if (found) { meal = found; return true; } return false; });
      if (meal) alert(`Recipe for ${meal.name}\n\nIngredients:\n- ${meal.ingredients.join('\n- ')}\n\nInstructions:\n${meal.instructions}`);
    }

    function addToCart(mealId) {
      let meal;
      Object.values(mealDatabase).some(cat => { const found = cat.find(m => m.id === mealId); if (found) { meal = found; return true; } return false; });
      if (!meal) return;
      const existing = cart.find(i => i.id === mealId);
      if (existing) existing.quantity += 1;
      else cart.push({ ...meal, quantity: 1, totalPrice: meal.price });
      updateCart();
      showNotification(`${meal.name} added to cart!`);
      showTab('shop');
    }

    function updateCart() {
      // this updates the meal planner cart UI (if present)
      // uses cartItems and subtotalEl / totalEl (these elements may be in meal planner tab)
      if (!cartItems) return;
      cartItems.innerHTML = '';
      let subtotal = 0;
      if (cart.length === 0) {
        cartItems.innerHTML = '<p class="text-center">Your cart is empty. Add some delicious meals!</p>';
      } else {
        cart.forEach(item => {
          const itemTotal = item.price * item.quantity;
          subtotal += itemTotal;
          const itemEl = document.createElement('div');
          itemEl.className = 'cart-item';
          itemEl.innerHTML = `<div class="cart-item-details"><h4>${item.name}</h4><p>KES ${item.price} x ${item.quantity}</p></div>
            <div class="cart-item-actions"><span class="cart-item-total">KES ${itemTotal}</span>
            <button class="btn btn-small btn-remove" data-meal-id="${item.id}"><i class="fas fa-trash"></i></button></div>`;
          cartItems.appendChild(itemEl);
        });
        document.querySelectorAll('.btn-remove').forEach(btn => btn.addEventListener('click', e => {
          const mealId = e.target.closest('button').getAttribute('data-meal-id'); removeFromCart(mealId);
        }));
      }
      const deliveryFee = subtotal > 2000 ? 0 : 150;
      const total = subtotal + deliveryFee;
      if (subtotalEl) subtotalEl.textContent = `KES ${subtotal}`;
      if (deliveryFeeEl) deliveryFeeEl.textContent = deliveryFee === 0 ? 'FREE' : `KES ${deliveryFee}`;
      if (totalEl) totalEl.textContent = `KES ${total}`;
      // ensure IntaSend amount sync
      updateCheckoutAmount();
    }

    function removeFromCart(mealId) {
      const idx = cart.findIndex(i => i.id === mealId);
      if (idx !== -1) {
        if (cart[idx].quantity > 1) cart[idx].quantity--;
        else cart.splice(idx, 1);
        updateCart();
        showNotification('Item removed from cart');
      }
    }

    // -------------------------
    // Nutrition / wizard / UI
    // -------------------------
    function calculateNutritionNeeds() {
      const age = parseInt(document.getElementById('age')?.value) || 25;
      const weight = parseInt(document.getElementById('weight')?.value) || 70;
      const height = parseInt(document.getElementById('height')?.value) || 170;
      const sex = document.querySelector('input[name="sex"]:checked')?.value || 'male';
      const activityLevel = document.querySelector('.activity-option.active')?.getAttribute('data-activity') || 'moderate';

      let bmr;
      if (sex === 'male') bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      else bmr = 10 * weight + 6.25 * height - 5 * age - 161;

      const activityMultipliers = { sedentary: 1.2, light: 1.375, moderate: 1.55, active: 1.725, 'very-active': 1.9 };
      const activityMultiplier = activityMultipliers[activityLevel] || 1.55;
      let tdee = bmr * activityMultiplier;

      const goal = document.querySelector('.goal-option.active')?.getAttribute('data-goal') || 'maintain';
      if (goal === 'lose') tdee -= 300; else if (goal === 'gain') tdee += 300;

      const proteinGrams = Math.round((tdee * 0.3) / 4);
      const fatGrams = Math.round((tdee * 0.3) / 9);
      const carbGrams = Math.round((tdee * 0.4) / 4);

      const caloriesEl = document.getElementById('caloriesTarget');
      const proteinEl = document.getElementById('proteinTarget');
      const carbsEl = document.getElementById('carbsTarget');
      const fatEl = document.getElementById('fatTarget');

      if (caloriesEl) caloriesEl.textContent = Math.round(tdee);
      if (proteinEl) proteinEl.textContent = proteinGrams;
      if (carbsEl) carbsEl.textContent = carbGrams;
      if (fatEl) fatEl.textContent = fatGrams;

      if (nutritionTargets) {
        nutritionTargets.style.display = 'block';
        nutritionTargets.scrollIntoView({ behavior: 'smooth' });
      }
      showNotification('Your nutrition targets have been updated!');
    }

    function showNotification(message) {
      document.querySelectorAll('.notification').forEach(n => n.remove());
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      notification.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px 25px; border-radius: 5px; z-index: 1000; animation: slideIn 0.5s, fadeOut 0.5s 2.5s; animation-fill-mode: forwards; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
      document.body.appendChild(notification);
      setTimeout(() => { notification.style.animation = 'fadeOut 0.5s'; notification.addEventListener('animationend', () => notification.remove()); }, 2000);
    }

    // Wizard block (keeps your implementation)
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('dietProfileForm');
      const steps = Array.from(document.querySelectorAll('.wizard-step'));
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const submitBtn = document.getElementById('submitBtn');
      let currentStep = 0;
      if (!form || steps.length === 0) return;

      function showStep(stepIndex) {
        steps.forEach((step, index) => {
          step.classList.toggle('active', index === stepIndex);
          const progressStep = document.querySelector(`.progress-step[data-step="${index + 1}"]`);
          if (progressStep) { progressStep.classList.toggle('active', index === stepIndex); progressStep.classList.toggle('completed', index < stepIndex); }
        });
        prevBtn.disabled = stepIndex === 0;
        nextBtn.style.display = stepIndex === steps.length - 1 ? 'none' : 'block';
        submitBtn.style.display = stepIndex === steps.length - 1 ? 'block' : 'none';
        steps[stepIndex].scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      nextBtn.addEventListener('click', function () { if (validateStep(currentStep)) { currentStep++; showStep(currentStep); } });
      prevBtn.addEventListener('click', function () { currentStep--; showStep(currentStep); });

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        if (validateStep(currentStep)) {
          const formData = new FormData(form);
          const formValues = Object.fromEntries(formData.entries());
          localStorage.setItem('dietProfile', JSON.stringify(formValues));
          showNotification('Profile setup completed successfully!');
          document.getElementById('profile-setup').style.display = 'none';
          document.getElementById('diet-tracker').style.display = 'block';
          calculateNutritionNeeds();
        }
      });

      function validateStep(stepIndex) {
        const currentStep = steps[stepIndex];
        const requiredFields = currentStep.querySelectorAll('[required]');
        let isValid = true;
        requiredFields.forEach(field => {
          if (!field.value.trim()) { field.classList.add('error'); isValid = false; } else field.classList.remove('error');
        });
        if (!isValid) showNotification('Please fill in all required fields');
        return isValid;
      }

      showStep(0);
    });

    // -------------------------
    // Grocery shopping logic
    // -------------------------
    const groceryItems = [
      { id: 1, name: "Apples", category: "fruits", price: 150, image: "assets/images/apple.jpg", unit: "kg" },
      { id: 2, name: "Bananas", category: "fruits", price: 80, image: "assets/images/banana.jpg", unit: "bunch" },
      { id: 3, name: "Spinach", category: "vegetables", price: 80, image: "assets/images/spinach.jpg", unit: "bunch" },
      { id: 4, name: "carots", category: "vegetables", price: 120, image: "assets/images/carots.jfif", unit: "kg" },
      { id: 5, name: "Tomatoes", category: "vegetables", price: 120, image: "assets/images/tomatoes.jpg", unit: "kg" },
      { id: 6, name: "Onions", category: "vegetables", price: 120, image: "assets/images/onions.jfif", unit: "kg" },
      { id: 7, name: "Milk", category: "dairy", price: 100, image: "assets/images/milk.jpg", unit: "litre" },
      { id: 8, name: "Rice", category: "grains", price: 200, image: "assets/images/rice.jfif", unit: "kg" },
      { id: 9, name: "Chicken", category: "meats", price: 500, image: "assets/images/chicken.jfif", unit: "kg" },
      { id: 10, name: "Beef", category: "meats", price: 600, image: "assets/images/beef.jfif", unit: "kg" }
    ];

    if (typeof window.deliveryFees === 'undefined') window.deliveryFees = { nairobi: 150, kisumu: 200, mombasa: 250, eldoret: 180 };
    if (typeof window.cart === 'undefined') window.cart = [];

    // init flow
    function initGrocerySection() {
      setupGroceryEventListeners();
      renderGroceryItems();
      updateCartDisplay();
      console.log('Grocery section initialized');
    }

    // pagination state
    let currentPage = 1;
    const itemsPerPage = 6;
    let currentFilter = "all";
    let filteredItems = [];

    function renderGroceryItems(filter = "all", append = false) {
      const container = document.getElementById("grocery-items");
      if (!container) return;
      const loadMoreContainer = document.getElementById("load-more-container");
      if (loadMoreContainer) loadMoreContainer.remove();
      if (filter !== currentFilter || !append) { currentPage = 1; currentFilter = filter; container.innerHTML = ""; }
      filteredItems = filter === "all" ? [...groceryItems] : groceryItems.filter(i => i.category === filter);
      if (filteredItems.length === 0) { container.innerHTML = '<div class="col-12 text-center py-5"><p>No items found in this category.</p></div>'; return; }
      const startIndex = 0;
      const endIndex = Math.min(startIndex + (currentPage * itemsPerPage), filteredItems.length);
      const itemsToShow = filteredItems.slice(0, endIndex);

      itemsToShow.forEach(item => {
        const col = document.createElement("div");
        col.className = "col-12 col-md-6 col-lg-4 mb-4";
        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <div style="height:180px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:#f8f9fa;">
              <img src="${item.image}" class="card-img-top" alt="${item.name}" style="width:100%; height:100%; object-fit:cover;">
            </div>
            <div class="card-body d-flex flex-column">
              <h5 class="card-title mb-1">${item.name}</h5>
              <p class="text-muted mb-2">${formatCategory(item.category)}</p>
              <p class="h5 text-primary mb-3">KSH ${item.price.toLocaleString()}/${item.unit}</p>
              <div class="mt-auto">
                <div class="input-group mb-2">
                  <span class="input-group-text">Qty</span>
                  <input type="number" class="form-control quantity" data-id="${item.id}" value="1" min="0.1" step="0.1" placeholder="Enter ${item.unit}s">
                  <span class="input-group-text">${item.unit}${item.unit === 'kg' || item.unit === 'litre' ? 's' : ''}</span>
                </div>
                <button class="btn btn-primary w-100 add-to-cart" data-id="${item.id}"><i class="fas fa-cart-plus me-2"></i>Add to Cart</button>
              </div>
            </div>
          </div>`;
        container.appendChild(col);
      });

      if (endIndex < filteredItems.length) {
        const loadMoreDiv = document.createElement('div');
        loadMoreDiv.id = 'load-more-container';
        loadMoreDiv.className = 'col-12 text-center mt-4 mb-5';
        loadMoreDiv.innerHTML = `<button id="load-more-btn" class="btn btn-outline-primary"><i class="fas fa-arrow-down me-2"></i>Load More Items</button>`;
        container.parentNode.appendChild(loadMoreDiv);
        document.getElementById('load-more-btn').addEventListener('click', () => {
          currentPage++;
          renderGroceryItems(currentFilter, true);
          setTimeout(() => {
            const items = container.querySelectorAll('.card');
            if (items.length > 0) items[items.length - 1].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }, 100);
        });
      }
    }

    function setupGroceryEventListeners() {
      document.querySelectorAll(".filter-btn").forEach(btn => {
        btn.addEventListener("click", function () {
          document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
          this.classList.add("active");
          const category = this.getAttribute("data-category");
          renderGroceryItems(category);
        });
      });

      // delegation for Add to Cart + Load more protection
      document.addEventListener("click", function (e) {
        if (e.target.closest('#load-more-btn')) return;
        const addBtn = e.target.closest(".add-to-cart");
        if (addBtn) {
          const id = parseInt(addBtn.getAttribute("data-id"));
          const qtyInput = document.querySelector(`.quantity[data-id="${id}"]`);
          const quantity = qtyInput ? parseFloat(qtyInput.value) : 1;
          if (isNaN(quantity) || quantity <= 0) { showToast("Please enter a valid quantity.", "error"); return; }
          addToGroceryCart(id, quantity);
        }
      });

      const emptyBtn = document.getElementById("empty-cart");
      if (emptyBtn) emptyBtn.addEventListener("click", emptyCart);

      const deliverySelect = document.getElementById("delivery-location");
      if (deliverySelect) deliverySelect.addEventListener("change", updateCartDisplay);

      const checkoutBtn = document.getElementById("checkout-btn");
      if (checkoutBtn) checkoutBtn.addEventListener("click", initiateCheckout);
    }

    function addToGroceryCart(itemId, quantity) {
      const item = groceryItems.find(i => i.id === itemId);
      if (!item) return;
      const existing = cart.find(i => i.id === itemId);
      if (existing) { existing.quantity += quantity; existing.totalPrice = existing.quantity * item.price; }
      else cart.push({ ...item, quantity, totalPrice: item.price * quantity });
      updateCartDisplay();
      showToast(`${item.name} added to cart!`, "success");
      animateCartIcon();
    }

    function updateCartDisplay() {
      const cartItemsEl = document.getElementById("cart-items");
      const cartSubtotalEl = document.getElementById("cart-subtotal");
      const cartCountEl = document.getElementById("cart-count");
      const deliveryFeeEl = document.getElementById("delivery-fee");
      const cartTotalEl = document.getElementById("cart-total");
      const checkoutBtn = document.getElementById("checkout-btn");

      if (!cartItemsEl) return;
      cartItemsEl.innerHTML = "";

      if (cart.length === 0) {
        cartItemsEl.innerHTML = '<li class="text-muted text-center py-2">Your cart is empty</li>';
        if (cartSubtotalEl) cartSubtotalEl.textContent = "0";
        if (deliveryFeeEl) deliveryFeeEl.textContent = "0";
        if (cartTotalEl) cartTotalEl.textContent = "0";
        if (cartCountEl) cartCountEl.textContent = "0";
        if (checkoutBtn) checkoutBtn.disabled = true;
        updateCheckoutAmount();
        return;
      }

      let subtotal = 0;
      cart.forEach(item => {
        subtotal += item.totalPrice || (item.price * (item.quantity || 1));
        const li = document.createElement("li");
        li.className = "d-flex justify-content-between align-items-center py-2 border-bottom";
        li.innerHTML = `<div><h6 class="mb-0">${item.name}</h6><small class="text-muted">${item.quantity} ${item.unit} × KSH ${item.price.toLocaleString()}</small></div>
          <div class="d-flex align-items-center"><span class="me-3">KSH ${(item.totalPrice || item.price * item.quantity).toLocaleString()}</span>
          <button class="btn btn-sm btn-outline-danger remove-item" data-id="${item.id}"><i class="fas fa-times"></i></button></div>`;
        cartItemsEl.appendChild(li);
      });

      const location = document.getElementById("delivery-location")?.value || '';
      const deliveryFee = window.deliveryFees?.[location] || 0;
      const total = subtotal + deliveryFee;

      if (cartSubtotalEl) cartSubtotalEl.textContent = subtotal.toLocaleString();
      if (deliveryFeeEl) deliveryFeeEl.textContent = deliveryFee.toLocaleString();
      if (cartTotalEl) cartTotalEl.textContent = total.toLocaleString();
      if (cartCountEl) cartCountEl.textContent = cart.reduce((s, i) => s + (i.quantity || 0), 0).toFixed(1);

      if (checkoutBtn) checkoutBtn.disabled = false;

      // remove handlers then rebind
      document.querySelectorAll(".remove-item").forEach(btn => {
        btn.addEventListener("click", function () {
          const itemId = parseInt(this.getAttribute("data-id"));
          removeFromGroceryCart(itemId);
        });
      });

      // make sure IntaSend amount synced
      updateCheckoutAmount();
    }

    function removeFromGroceryCart(itemId) {
      const idx = cart.findIndex(i => i.id === itemId);
      if (idx !== -1) { cart.splice(idx, 1); updateCartDisplay(); showToast("Item removed from cart", "info"); }
    }

    function emptyCart() {
      cart = [];
      updateCartDisplay();
      showToast("Cart has been emptied", "info");
    }

    function animateCartIcon() {
      const icon = document.getElementById("grocery-cart-icon"); if (!icon) return;
      icon.classList.add("pop"); setTimeout(() => icon.classList.remove("pop"), 300);
    }

    function showToast(message, type = "info") {
      const toastEl = document.getElementById("toast"); if (!toastEl) return;
      const toastBody = toastEl.querySelector(".toast-body");
      toastBody.textContent = message;
      const toastTypes = ["bg-primary", "bg-success", "bg-danger", "bg-warning", "bg-info"];
      toastEl.classList.remove(...toastTypes);
      const typeClass = { success: "bg-success text-white", error: "bg-danger text-white", warning: "bg-warning text-dark", info: "bg-info text-dark" }[type] || "bg-primary text-white";
      toastEl.classList.add(...typeClass.split(" "));
      const toast = new bootstrap.Toast(toastEl); toast.show();
    }

    function formatCategory(category) { return category.charAt(0).toUpperCase() + category.slice(1); }

    // -------------------------
    // Checkout / IntaSend glue
    // -------------------------
    // Compute current totals and set checkout button data-amount (in minor units: cents)
    function updateCheckoutAmount() {
      const subtotal = cart.reduce((s, i) => s + (i.totalPrice || (i.price * (i.quantity || 1))), 0);
      const location = document.getElementById("delivery-location")?.value || '';
      const deliveryFee = window.deliveryFees?.[location] || 0;
      const total = subtotal + deliveryFee;
      const checkoutBtn = document.getElementById("checkout-btn");
      if (checkoutBtn) {
        // set amount in cents (rounded)
        checkoutBtn.setAttribute("data-amount", Math.round(total * 100));
        // optional human-readable attribute
        checkoutBtn.setAttribute("data-amount-display", total.toLocaleString());
      }
    }

    // Trigger checkout (SDK will handle actual payment flow)
    async function initiateCheckout() {
      if (cart.length === 0) {
        showToast("Your cart is empty!", "error");
        return;
      }

      // Collect customer info (you can improve this with a proper form)
      const email = prompt("Please enter your email address:");
      const phone = prompt("Please enter your phone number (e.g., 254700123456):");

      if (!email || !phone) {
        showToast("Email and phone number are required for checkout", "error");
        return;
      }

      updateCheckoutAmount();

      const subtotal = cart.reduce((s, i) => s + (i.totalPrice || (i.price * (i.quantity || 1))), 0);
      const location = document.getElementById("delivery-location")?.value || 'nairobi';
      const deliveryFee = window.deliveryFees?.[location] || 150;
      const total = subtotal + deliveryFee;

      // Update button attributes for IntaSend
      const checkoutBtn = document.getElementById("checkout-btn");
      if (checkoutBtn) {
        checkoutBtn.setAttribute("data-amount", total);
        checkoutBtn.setAttribute("data-email", email);
        checkoutBtn.setAttribute("data-phone-number", phone);
        checkoutBtn.setAttribute("data-api-ref", `order_${Date.now()}`);

        // Trigger the IntaSend payment (the SDK handles this automatically when button is clicked)
        showToast("Redirecting to payment...", "info");
      }
    }
    // Budget Tracking Functions
    function initBudgetTracking() {
      // Load budget from localStorage or use defaults
      const budgetData = JSON.parse(localStorage.getItem('budgetData')) || {
        monthlyBudget: 20000,
        spent: 13000,
        categories: {
          groceries: 8500,
          diningOut: 3200,
          snacks: 1300,
          beverages: 2000
        },
        transactions: [
          { id: 1, merchant: 'Nakumatt Supermarket', category: 'groceries', amount: 2450, date: 'Today' },
          { id: 2, merchant: 'Artcaffé', category: 'diningOut', amount: 1850, date: 'Yesterday' },
          { id: 3, merchant: 'Naivas Supermarket', category: 'groceries', amount: 3200, date: '2 days ago' }
        ]
      };

      // Update UI with budget data
      function updateBudgetUI() {
        const { monthlyBudget, spent, categories } = budgetData;
        const remaining = monthlyBudget - spent;
        const percentageSpent = (spent / monthlyBudget) * 100;

        // Update budget summary
        document.getElementById('monthly-budget').value = monthlyBudget;
        document.getElementById('budget-remaining').textContent = `KES ${remaining.toLocaleString()}`;
        document.getElementById('total-budget').textContent = `KES ${monthlyBudget.toLocaleString()}`;
        document.getElementById('amount-spent').textContent = `KES ${spent.toLocaleString()} (${Math.round(percentageSpent)}%)`;

        // Update progress bar
        const progressBar = document.getElementById('budget-progress');
        progressBar.style.width = `${Math.min(percentageSpent, 100)}%`;
        progressBar.className = `progress-bar ${percentageSpent > 80 ? 'bg-danger' : percentageSpent > 50 ? 'bg-warning' : 'bg-success'}`;
        progressBar.setAttribute('aria-valuenow', Math.round(percentageSpent));
      }

      // Update budget when form is submitted
      document.getElementById('update-budget').addEventListener('click', function () {
        const newBudget = parseInt(document.getElementById('monthly-budget').value) || 0;
        if (newBudget > 0) {
          budgetData.monthlyBudget = newBudget;
          saveBudgetData();
          updateBudgetUI();
          showNotification('Budget updated successfully!', 'success');
        } else {
          showNotification('Please enter a valid budget amount', 'error');
        }
      });

      // Add new expense
      document.getElementById('add-expense').addEventListener('click', function () {
        // In a real app, this would open a modal to add a new expense
        showNotification('Feature coming soon! You will be able to add expenses here.', 'info');
      });

      // Save budget data to localStorage
      function saveBudgetData() {
        localStorage.setItem('budgetData', JSON.stringify(budgetData));
      }

      // Initialize the UI
      updateBudgetUI();
    }

    // ============================================
    // Personalized Meal Plans Functionality
    // ============================================

    // Sample meal data (in a real app, this would come from an API)
    const sampleMeals = {
      breakfast: [
        { id: 'bf1', name: 'Avocado Toast', calories: 320, protein: 10, carbs: 30, fat: 18, prepTime: 10, rating: 4.5, diet: ['vegetarian', 'vegan', 'mediterranean'] },
        { id: 'bf2', name: 'Greek Yogurt with Berries', calories: 280, protein: 15, carbs: 35, fat: 8, prepTime: 5, rating: 4.2, diet: ['vegetarian', 'mediterranean'] },
        { id: 'bf3', name: 'Vegetable Omelette', calories: 350, protein: 22, carbs: 12, fat: 24, prepTime: 15, rating: 4.7, diet: ['vegetarian', 'keto', 'low-carb'] },
        { id: 'bf4', name: 'Oatmeal with Nuts', calories: 380, protein: 12, carbs: 55, fat: 14, prepTime: 10, rating: 4.3, diet: ['vegetarian', 'vegan', 'balanced'] },
        { id: 'bf5', name: 'Smoothie Bowl', calories: 320, protein: 8, carbs: 45, fat: 12, prepTime: 8, rating: 4.4, diet: ['vegetarian', 'vegan', 'balanced'] }
      ],
      lunch: [
        { id: 'ln1', name: 'Quinoa Salad Bowl', calories: 420, protein: 18, carbs: 45, fat: 20, prepTime: 20, rating: 4.7, diet: ['vegetarian', 'vegan', 'mediterranean'] },
        { id: 'ln2', name: 'Grilled Chicken Wrap', calories: 480, protein: 35, carbs: 30, fat: 25, prepTime: 15, rating: 4.5, diet: ['balanced', 'low-carb'] },
        { id: 'ln3', name: 'Caesar Salad with Salmon', calories: 450, protein: 30, carbs: 15, fat: 32, prepTime: 15, rating: 4.6, diet: ['keto', 'low-carb', 'paleo'] },
        { id: 'ln4', name: 'Veggie Burger', calories: 380, protein: 22, carbs: 40, fat: 16, prepTime: 10, rating: 4.3, diet: ['vegetarian', 'vegan'] },
        { id: 'ln5', name: 'Sushi Bowl', calories: 400, protein: 25, carbs: 55, fat: 10, prepTime: 15, rating: 4.4, diet: ['balanced', 'mediterranean'] }
      ],
      dinner: [
        { id: 'dn1', name: 'Grilled Salmon with Veggies', calories: 480, protein: 35, carbs: 25, fat: 28, prepTime: 30, rating: 4.8, diet: ['keto', 'paleo', 'mediterranean'] },
        { id: 'dn2', name: 'Chicken Stir Fry', calories: 420, protein: 40, carbs: 30, fat: 18, prepTime: 25, rating: 4.6, diet: ['balanced', 'low-carb'] },
        { id: 'dn3', name: 'Lentil Curry with Rice', calories: 450, protein: 22, carbs: 65, fat: 10, prepTime: 35, rating: 4.5, diet: ['vegetarian', 'vegan'] },
        { id: 'dn4', name: 'Beef and Broccoli', calories: 460, protein: 38, carbs: 20, fat: 26, prepTime: 25, rating: 4.7, diet: ['keto', 'paleo'] },
        { id: 'dn5', name: 'Mushroom Risotto', calories: 420, protein: 12, carbs: 60, fat: 15, prepTime: 40, rating: 4.4, diet: ['vegetarian'] }
      ],
      snack: [
        { id: 'sn1', name: 'Almonds & Dark Chocolate', calories: 200, protein: 6, carbs: 12, fat: 16, prepTime: 2, rating: 4.3, diet: ['keto', 'paleo', 'vegetarian'] },
        { id: 'sn2', name: 'Greek Yogurt with Honey', calories: 180, protein: 15, carbs: 20, fat: 5, prepTime: 2, rating: 4.2, diet: ['vegetarian', 'mediterranean'] },
        { id: 'sn3', name: 'Veggies with Hummus', calories: 160, protein: 6, carbs: 18, fat: 9, prepTime: 5, rating: 4.1, diet: ['vegetarian', 'vegan', 'mediterranean'] },
        { id: 'sn4', name: 'Protein Shake', calories: 220, protein: 25, carbs: 15, fat: 6, prepTime: 5, rating: 4.0, diet: ['vegetarian', 'keto', 'low-carb'] },
        { id: 'sn5', name: 'Rice Cakes with Peanut Butter', calories: 210, protein: 7, carbs: 25, fat: 10, prepTime: 3, rating: 4.3, diet: ['vegetarian', 'vegan'] }
      ]
    };

    // Diet type mapping to filter meals
    const dietFilters = {
      'balanced': [], // No specific filter for balanced
      'keto': ['keto'],
      'vegetarian': ['vegetarian'],
      'vegan': ['vegan'],
      'low-carb': ['low-carb'],
      'mediterranean': ['mediterranean'],
      'paleo': ['paleo']
    };

    // Initialize meal planning functionality when the page loads
    function initializeMealPlans() {
      console.log('Initializing meal plans...');

      // Check if Bootstrap is available
      if (typeof bootstrap === 'undefined' || !bootstrap.Tab) {
        const errorMsg = 'Bootstrap not loaded. Please make sure Bootstrap JS is included before this script.';
        console.error(errorMsg);
        showNotification(errorMsg, 'danger');
        return;
      }

      try {
        // Initialize tab functionality first
        const tabEls = Array.from(document.querySelectorAll('#mealPlanTabs button[data-bs-toggle="tab"]'));
        console.log(`Found ${tabEls.length} tab elements`);

        if (tabEls.length > 0) {
          // Set up click handlers for all tabs
          tabEls.forEach(tabEl => {
            tabEl.addEventListener('click', function (e) {
              e.preventDefault();
              const tabId = this.getAttribute('data-bs-target');
              console.log('Tab clicked:', tabId);

              // Remove active class from all tabs and panes
              document.querySelectorAll('#mealPlanTabs .nav-link').forEach(link => {
                link.classList.remove('active');
              });
              document.querySelectorAll('#mealPlanTabsContent .tab-pane').forEach(pane => {
                pane.classList.remove('show', 'active');
              });

              // Add active class to clicked tab and corresponding pane
              this.classList.add('active');
              const targetPane = document.querySelector(tabId);
              if (targetPane) {
                targetPane.classList.add('show', 'active');
                localStorage.setItem('activeMealPlanTab', tabId);
              }
            });
          });

          // Restore active tab from storage or default to first tab
          const activeTabId = localStorage.getItem('activeMealPlanTab') || '#weekly-plan';
          console.log('Active tab from storage:', activeTabId);

          // Find and activate the tab
          const tabToActivate = document.querySelector(`#mealPlanTabs button[data-bs-target="${activeTabId}"]`);
          if (tabToActivate) {
            console.log('Activating tab:', activeTabId);
            tabToActivate.click(); // Use click to trigger our custom handler
          } else if (tabEls.length > 0) {
            // If saved tab not found, activate first tab
            console.log('Saved tab not found, defaulting to first tab');
            tabEls[0].click();
          }
        } else {
          console.warn('No tab elements found with selector: #mealPlanTabs button[data-bs-toggle="tab"]');
        }

        // Now initialize the components
        console.log('Initializing portion control...');
        if (typeof initPortionControl === 'function') {
          initPortionControl();
        } else {
          console.error('initPortionControl function not found!');
        }

        console.log('Initializing meal plan generator...');
        if (typeof initMealPlanGenerator === 'function') {
          initMealPlanGenerator();
        } else {
          console.error('initMealPlanGenerator function not found!');
        }

        console.log('Initializing recipe swaps...');
        if (typeof initRecipeSwaps === 'function') {
          initRecipeSwaps();
        } else {
          console.error('initRecipeSwaps function not found!');
        }
      } catch (error) {
        const errorMsg = `Error initializing meal plans: ${error.message}`;
        console.error(errorMsg, error);
        showNotification(errorMsg, 'danger');
      }
    }

    // Initialize when the DOM is fully loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeMealPlans);
    } else {
      // DOMContentLoaded has already fired
      initializeMealPlans();
    }

    // ============================================
    // Portion Control Functionality
    // ============================================
    function initPortionControl() {
      const portionPeople = document.getElementById('portionPeople');
      const portionPeopleValue = document.getElementById('portionPeopleValue');
      const activityLevel = document.getElementById('activityLevel');
      const dietaryGoal = document.getElementById('dietaryGoal');
      const applyBtn = document.getElementById('applyPortionSettings');

      // Update portion visualization when inputs change
      [portionPeople, activityLevel, dietaryGoal].forEach(element => {
        if (element) {
          element.addEventListener('input', updatePortionVisualization);
          element.addEventListener('change', updatePortionVisualization);
        }
      });

      // Apply portion settings to meal plan
      if (applyBtn) {
        applyBtn.addEventListener('click', function () {
          showNotification('Portion settings applied to your meal plan!', 'success');
          // In a real app, this would update the meal plan with new portion sizes
        });
      }

      // Initial update
      updatePortionVisualization();
    }

    function updatePortionVisualization() {
      const portionPeople = document.getElementById('portionPeople');
      const portionPeopleValue = document.getElementById('portionPeopleValue');
      const activityLevel = document.getElementById('activityLevel');
      const portionSize = document.getElementById('portionSize');
      const portionFill = document.getElementById('portionFill');
      const dietaryGoal = document.getElementById('dietaryGoal');

      if (!portionPeople || !activityLevel || !portionSize || !portionFill || !dietaryGoal) return;

      const people = parseInt(portionPeople.value);
      const activity = activityLevel.value;
      const goal = dietaryGoal.value;

      // Update people count display
      if (portionPeopleValue) {
        portionPeopleValue.textContent = `${people} ${people === 1 ? 'person' : 'people'}`;
      }

      // Calculate portion size based on inputs
      let size = 1.0;

      // Adjust based on activity level
      if (activity === 'sedentary') size = 0.8;
      else if (activity === 'moderate') size = 1.2;
      else if (activity === 'active') size = 1.4;
      else if (activity === 'extreme') size = 1.6;

      // Adjust based on dietary goal
      if (goal === 'lose') size *= 0.9;
      else if (goal === 'gain') size *= 1.2;

      // Update visual elements
      const portionPercentage = Math.min(100, Math.round(size * 100));
      portionFill.style.width = `${portionPercentage}%`;

      // Update portion size text
      if (portionSize) {
        if (portionPercentage < 70) portionSize.textContent = 'Small';
        else if (portionPercentage > 130) portionSize.textContent = 'Large';
        else portionSize.textContent = 'Standard';
      }

      // Update nutritional targets
      updateNutritionalTargets(people, size);
    }

    function updateNutritionalTargets(people, sizeMultiplier) {
      const baseCalories = 2000;
      const baseProtein = 150;
      const baseCarbs = 250;
      const baseFats = 65;

      const adjustedCalories = Math.round(baseCalories * sizeMultiplier);
      const adjustedProtein = Math.round(baseProtein * sizeMultiplier);
      const adjustedCarbs = Math.round(baseCarbs * sizeMultiplier);
      const adjustedFats = Math.round(baseFats * sizeMultiplier);

      // Update the display
      const caloriesTarget = document.getElementById('caloriesTarget');
      const proteinTarget = document.getElementById('proteinTarget');
      const carbsTarget = document.getElementById('carbsTarget');
      const fatsTarget = document.getElementById('fatsTarget');

      if (caloriesTarget) caloriesTarget.textContent = adjustedCalories.toLocaleString();
      if (proteinTarget) proteinTarget.textContent = `${adjustedProtein}g`;
      if (carbsTarget) carbsTarget.textContent = `${adjustedCarbs}g`;
      if (fatsTarget) fatsTarget.textContent = `${adjustedFats}g`;

      // Update portion details
      const mealSizeDetail = document.getElementById('mealSizeDetail');
      const caloriesDetail = document.getElementById('caloriesDetail');
      const proteinDetail = document.getElementById('proteinDetail');
      const carbsDetail = document.getElementById('carbsDetail');

      if (mealSizeDetail) {
        mealSizeDetail.textContent =
          sizeMultiplier < 0.9 ? 'Smaller portion' :
            sizeMultiplier > 1.3 ? 'Larger portion' : 'Standard portion';
      }

      if (caloriesDetail) {
        const perMealCalories = Math.round(adjustedCalories / 3);
        caloriesDetail.textContent = `${perMealCalories - 50}-${perMealCalories + 50} per meal`;
      }

      if (proteinDetail) {
        const perMealProtein = Math.round(adjustedProtein / 3);
        proteinDetail.textContent = `${perMealProtein - 5}-${perMealProtein + 5}g per meal`;
      }

      if (carbsDetail) {
        const perMealCarbs = Math.round(adjustedCarbs / 3);
        carbsDetail.textContent = `${perMealCarbs - 10}-${perMealCarbs + 10}g per meal`;
      }
    }

    // ============================================
    // Meal Plan Generator Functionality
    // ============================================
    function initMealPlanGenerator() {
      console.log('Initializing meal plan generator...');

      const generateBtn = document.getElementById('generateMealPlan');
      const printBtn = document.getElementById('printMealPlan');
      const saveBtn = document.getElementById('saveMealPlan');
      const shopBtn = document.getElementById('shopForPlan');

      if (generateBtn) {
        console.log('Found generate button, adding click handler');
        generateBtn.addEventListener('click', generateMealPlan);
      } else {
        console.error('Generate button not found!');
      }

      if (printBtn) {
        printBtn.addEventListener('click', function () {
          window.print();
        });
      } else {
        console.warn('Print button not found');
      }

      if (saveBtn) {
        saveBtn.addEventListener('click', function () {
          showNotification('Meal plan saved successfully!', 'success');
          // In a real app, this would save the meal plan to the user's account
        });
      } else {
        console.warn('Save button not found');
      }

      if (shopBtn) {
        shopBtn.addEventListener('click', function () {
          // In a real app, this would generate a shopping list
          showNotification('Shopping list generated!', 'info');
        });
      } else {
        console.warn('Shop button not found');
      }

      // Check for saved meal plans
      const savedPlan = localStorage.getItem('savedMealPlan');
      if (savedPlan) {
        try {
          console.log('Found saved meal plan, rendering...');
          const plan = JSON.parse(savedPlan);
          renderMealPlan(plan);
        } catch (e) {
          console.error('Error loading saved meal plan:', e);
        }
      } else {
        console.log('No saved meal plan found in localStorage');
      }

      // Add debug info
      console.log('Meal plan generator initialization complete');
    }

    function generateMealPlan() {
      const dietType = document.getElementById('dietType').value;
      const mealsPerDay = parseInt(document.getElementById('mealsPerDay').value);
      const duration = parseInt(document.getElementById('planDuration').value);

      // Validate inputs
      if (!dietType || isNaN(mealsPerDay) || isNaN(duration)) {
        showNotification('Please fill in all meal plan options.', 'warning');
        return;
      }

      // Show loading state
      const mealPlanContainer = document.getElementById('mealPlanContainer');
      const mealPlanDays = document.getElementById('mealPlanDays');

      mealPlanDays.innerHTML = `
        <div class="col-12 text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3">Generating your personalized meal plan...</p>
        </div>`;

      mealPlanContainer.classList.remove('d-none');

      // Simulate API call with timeout
      setTimeout(() => {
        const mealPlan = createMealPlan(dietType, mealsPerDay, duration);
        renderMealPlan(mealPlan);

        // Save to localStorage
        localStorage.setItem('savedMealPlan', JSON.stringify(mealPlan));

        // Scroll to the meal plan
        mealPlanContainer.scrollIntoView({ behavior: 'smooth' });
      }, 1000);
    }

    function createMealPlan(dietType, mealsPerDay, duration) {
      const mealPlan = [];
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const today = new Date();

      // Get the diet filters to apply
      const dietFilter = dietFilters[dietType] || [];

      for (let i = 0; i < duration; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() + i);

        const dayName = days[date.getDay()];
        const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

        const dayPlan = {
          day: dayName,
          date: dateStr,
          meals: []
        };

        // Add breakfast
        if (mealsPerDay >= 3) {
          dayPlan.meals.push({
            type: 'Breakfast',
            ...getRandomMeal('breakfast', dietFilter)
          });
        }

        // Add lunch
        if (mealsPerDay >= 2) {
          dayPlan.meals.push({
            type: 'Lunch',
            ...getRandomMeal('lunch', dietFilter)
          });
        }

        // Add dinner
        dayPlan.meals.push({
          type: 'Dinner',
          ...getRandomMeal('dinner', dietFilter)
        });

        // Add snacks if needed
        if (mealsPerDay >= 4) {
          dayPlan.meals.push({
            type: 'Snack',
            ...getRandomMeal('snack', dietFilter)
          });
        }

        if (mealsPerDay >= 5) {
          dayPlan.meals.push({
            type: 'Snack',
            ...getRandomMeal('snack', dietFilter)
          });
        }

        mealPlan.push(dayPlan);
      }

      return mealPlan;
    }

    function getRandomMeal(mealType, dietFilter) {
      // Filter meals by type and diet
      let filteredMeals = sampleMeals[mealType] || [];

      if (dietFilter.length > 0) {
        filteredMeals = filteredMeals.filter(meal =>
          dietFilter.some(diet => meal.diet.includes(diet))
        );
      }

      // If no meals match the filter, return any meal of the type
      if (filteredMeals.length === 0) {
        filteredMeals = sampleMeals[mealType] || [];
      }

      // Return a random meal
      return filteredMeals[Math.floor(Math.random() * filteredMeals.length)];
    }

    function renderMealPlan(mealPlan) {
      const mealPlanDays = document.getElementById('mealPlanDays');

      if (!mealPlanDays || !mealPlan || !Array.isArray(mealPlan)) return;

      let html = '';

      mealPlan.forEach(day => {
        let mealsHtml = '';

        day.meals.forEach(meal => {
          mealsHtml += `
            <div class="meal-item d-flex align-items-center p-2 border-bottom">
              <div class="flex-shrink-0 me-3">
                <div class="meal-type-badge bg-light text-dark rounded-pill px-3 py-1 small">
                  ${meal.type}
                </div>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-0">${meal.name}</h6>
                <div class="d-flex small text-muted">
                  <span class="me-2">${meal.calories} cal</span>
                  <span class="me-2">•</span>
                  <span class="me-2">${meal.prepTime} min</span>
                  <span class="me-2">•</span>
                  <span>${meal.rating} <i class="fas fa-star text-warning"></i></span>
                </div>
              </div>
              <div class="flex-shrink-0">
                <button class="btn btn-sm btn-outline-primary swap-meal" data-meal-id="${meal.id}">
                  <i class="fas fa-exchange-alt"></i>
                </button>
              </div>
            </div>`;
        });

        html += `
          <div class="col-md-6 col-lg-4">
            <div class="card h-100">
              <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">${day.day}</h5>
                <span class="text-muted small">${day.date}</span>
              </div>
              <div class="card-body p-0">
                <div class="meal-list">
                  ${mealsHtml}
                </div>
              </div>
              <div class="card-footer bg-transparent text-center">
                <button class="btn btn-sm btn-outline-secondary w-100 view-day-details">
                  <i class="fas fa-utensils me-1"></i> View Details
                </button>
              </div>
            </div>
          </div>`;
      });

      mealPlanDays.innerHTML = html;

      // Add event listeners for swap buttons
      document.querySelectorAll('.swap-meal').forEach(btn => {
        btn.addEventListener('click', function () {
          const mealId = this.getAttribute('data-meal-id');
          // In a real app, this would open the recipe swap interface
          showNotification(`Swap meal ${mealId} clicked`, 'info');

          // For demo, switch to the Recipe Swaps tab
          const swapTab = document.querySelector('[data-bs-target="#recipe-swaps"]');
          if (swapTab) {
            const tab = new bootstrap.Tab(swapTab);
            tab.show();
          }
        });
      });

      // Add event listeners for view details buttons
      document.querySelectorAll('.view-day-details').forEach(btn => {
        btn.addEventListener('click', function () {
          // In a real app, this would show detailed meal information
          showNotification('Viewing day details', 'info');
        });
      });
    }

    // ============================================
    // Recipe Swaps Functionality
    // ============================================
    function initRecipeSwaps() {
      const searchInput = document.getElementById('recipeSearch');
      const searchBtn = document.getElementById('searchRecipes');
      const dietaryFilter = document.getElementById('dietaryFilter');
      const sortOptions = document.querySelectorAll('.sort-option');

      // Search functionality
      if (searchBtn && searchInput) {
        searchBtn.addEventListener('click', () => searchRecipes(searchInput.value, dietaryFilter.checked));

        searchInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            searchRecipes(searchInput.value, dietaryFilter.checked);
          }
        });
      }

      // Dietary filter toggle
      if (dietaryFilter) {
        dietaryFilter.addEventListener('change', () => {
          if (searchInput.value) {
            searchRecipes(searchInput.value, dietaryFilter.checked);
          }
        });
      }

      // Sort options
      sortOptions.forEach(option => {
        option.addEventListener('click', (e) => {
          e.preventDefault();

          // Update active state
          sortOptions.forEach(opt => opt.classList.remove('active'));
          option.classList.add('active');

          // Get sort type
          const sortType = option.getAttribute('data-sort');

          // In a real app, this would re-sort the search results
          showNotification(`Sorted by: ${sortType.replace('-', ' ')}`, 'info');
        });
      });

      // Load popular swaps
      loadPopularSwaps();
    }

    function searchRecipes(query, matchDietary = true) {
      if (!query) {
        showNotification('Please enter a search term', 'warning');
        return;
      }

      const suggestionsList = document.querySelector('.suggestions-list');
      const placeholder = document.querySelector('.suggestions-placeholder');

      // Show loading state
      if (suggestionsList && placeholder) {
        suggestionsList.innerHTML = `
          <div class="text-center p-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 mb-0">Searching for recipes...</p>
          </div>`;

        placeholder.classList.add('d-none');
        suggestionsList.style.display = 'block';
      }

      // Simulate API call with timeout
      setTimeout(() => {
        // In a real app, this would be an API call to search recipes
        const results = [];

        // Search through sample meals (simplified for demo)
        Object.values(sampleMeals).forEach(meals => {
          meals.forEach(meal => {
            if (meal.name.toLowerCase().includes(query.toLowerCase())) {
              results.push(meal);
            }
          });
        });

        // Limit to 5 results for demo
        const limitedResults = results.slice(0, 5);

        // Display results
        displaySearchResults(limitedResults, suggestionsList, placeholder);
      }, 800);
    }

    function displaySearchResults(results, container, placeholder) {
      if (!container) return;

      if (results.length === 0) {
        container.innerHTML = `
          <div class="text-center p-4">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h5>No recipes found</h5>
            <p class="text-muted">Try a different search term</p>
          </div>`;
        return;
      }

      let html = '';

      results.forEach(meal => {
        html += `
          <div class="recipe-suggestion p-3 border-bottom">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0 me-3">
                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                  <i class="fas fa-utensils text-muted"></i>
                </div>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-0">${meal.name}</h6>
                <div class="d-flex small text-muted">
                  <span class="me-2">${meal.calories} cal</span>
                  <span class="me-2">•</span>
                  <span class="me-2">${meal.prepTime} min</span>
                  <span class="me-2">•</span>
                  <span>${meal.rating} <i class="fas fa-star text-warning"></i></span>
                </div>
              </div>
              <div class="flex-shrink-0">
                <button class="btn btn-sm btn-outline-primary select-recipe" data-meal-id="${meal.id}">
                  Select
                </button>
              </div>
            </div>
          </div>`;
      });

      container.innerHTML = html;

      // Add event listeners to select buttons
      document.querySelectorAll('.select-recipe').forEach(btn => {
        btn.addEventListener('click', function () {
          const mealId = this.getAttribute('data-meal-id');
          // In a real app, this would update the selected recipe
          showNotification(`Recipe ${mealId} selected`, 'success');
        });
      });
    }

    function loadPopularSwaps() {
      const popularSwapsContainer = document.getElementById('popularSwaps');
      if (!popularSwapsContainer) return;

      // In a real app, this would fetch popular swaps from an API
      const popularSwaps = [
        { from: 'Pasta', to: 'Zucchini Noodles', reason: 'Lower carb alternative' },
        { from: 'Rice', to: 'Cauliflower Rice', reason: 'Low-carb, high-fiber' },
        { from: 'Potato Mash', to: 'Cauliflower Mash', reason: 'Lower calorie option' },
        { from: 'Beef Burger', to: 'Portobello Mushroom Burger', reason: 'Vegetarian alternative' },
        { from: 'White Bread', to: 'Whole Grain Bread', reason: 'Higher fiber content' },
        { from: 'Sour Cream', to: 'Greek Yogurt', reason: 'Higher protein, lower fat' }
      ];

      let html = '';

      popularSwaps.forEach(swap => {
        html += `
          <div class="col-md-6 col-lg-4">
            <div class="card h-100">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <span class="badge bg-light text-dark me-2">SWAP</span>
                  <h6 class="mb-0">${swap.from} <i class="fas fa-arrow-right mx-2 text-muted"></i> ${swap.to}</h6>
                </div>
                <p class="small text-muted mb-0">${swap.reason}</p>
              </div>
              <div class="card-footer bg-transparent text-end">
                <button class="btn btn-sm btn-outline-primary">Try This Swap</button>
              </div>
            </div>
          </div>`;
      });

      popularSwapsContainer.innerHTML = html;
    }

    // ============================================
    // Helper Functions
    // ============================================

    function showNotification(message, type = 'info') {
      // Check if Toast is available (Bootstrap 5)
      if (typeof bootstrap !== 'undefined' && bootstrap.Toast) {
        const toastEl = document.createElement('div');
        toastEl.className = `toast align-items-center text-white bg-${type} border-0`;
        toastEl.setAttribute('role', 'alert');
        toastEl.setAttribute('aria-live', 'assertive');
        toastEl.setAttribute('aria-atomic', 'true');

        toastEl.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">
              ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>`;

        const toastContainer = document.getElementById('toastContainer');
        if (toastContainer) {
          toastContainer.appendChild(toastEl);

          const toast = new bootstrap.Toast(toastEl, {
            autohide: true,
            delay: 3000
          });

          toast.show();

          // Remove the toast after it's hidden
          toastEl.addEventListener('hidden.bs.toast', function () {
            toastEl.remove();
          });
        } else {
          // Fallback to alert if toast container doesn't exist
          alert(`${type.toUpperCase()}: ${message}`);
        }
      } else {
        // Fallback to alert if Bootstrap Toast is not available
        alert(`${type.toUpperCase()}: ${message}`);
      }
    }

    // ============================================
    // Expose some global helpers
    // ============================================
    window.viewRecipe = viewRecipe;
    window.addToCart = addToCart;
    window.generateMealPlan = generateMealPlan;
    window.generateMeals = generateMealSuggestions; // Make the meal generation function available globally
    window.removeFromCart = removeFromCart;
    window.generateMeals = generateMeals;
    window.calculateNutritionNeeds = calculateNutritionNeeds;
    window.initiateCheckout = initiateCheckout;
    window.updateCheckoutAmount = updateCheckoutAmount;

  </script>



  <!-- Initialize IntaSend -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      setTimeout(() => {
        if (typeof window.IntaSend !== 'undefined' && window.APP_CONFIG?.intasend?.publicKey) {
          try {
            const intasend = new window.IntaSend({
              publicAPIKey: window.APP_CONFIG.intasend.publicKey,
              live: window.APP_CONFIG.intasend.live
            });

            intasend
              .on("COMPLETE", (results) => {
                console.log("Payment successful:", results);
                showToast("Payment completed successfully! Check your email for confirmation.", "success");

                // Clear cart and show success
                cart = [];
                updateCartDisplay();

                // Redirect to success page after 3 seconds
                setTimeout(() => {
                  window.location.href = 'order-success.html?ref=' + results.api_ref;
                }, 3000);
              })
              .on("FAILED", (results) => {
                console.log("Payment failed:", results);
                showToast("Payment failed: " + (results.failed_reason || "Please try again"), "error");
              })
              .on("IN-PROGRESS", (results) => {
                console.log("Payment in progress:", results);
                showToast("Processing your payment... Please wait.", "info");
              });

            console.log('IntaSend initialized successfully with live key');
          } catch (error) {
            console.error('IntaSend initialization failed:', error);
            showToast("Payment system unavailable. Please try again later.", "error");
          }
        } else {
          console.error('IntaSend SDK not loaded or config missing');
        }
      }, 1000);
    });
  </script>

</body>

</html>