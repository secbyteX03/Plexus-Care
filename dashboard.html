<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Plexus Care</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="nav-logo">Plexus Care</a>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li class="nav-item">
                    <a href="#" class="nav-link has-dropdown">
                        Conditions
                        <span class="arrow"></span>
                    </a>
                    <div class="dropdown">
                        <div class="mega-menu">
                            <div class="mega-menu-section initial-items">
                                <h4>Common Conditions</h4>
                                <ul class="mega-menu-links">
                                    <li><a href="#">ADD/ADHD</a></li>
                                    <li><a href="#">Allergies</a></li>
                                    <li><a href="#">Arthritis</a></li>
                                    <li><a href="#">Atrial fibrillation</a></li>
                                    <li><a href="#">Breast Cancer</a></li>
                                    <li><a href="#">Cancer</a></li>
                                </ul>
                            </div>
                            <div class="mega-menu-section initial-items">
                                <h4>Chronic Conditions</h4>
                                <ul class="mega-menu-links">
                                    <li><a href="#">Crohn's Disease</a></li>
                                    <li><a href="#">Depression</a></li>
                                    <li><a href="#">Diabetes</a></li>
                                    <li><a href="#">DVT</a></li>
                                    <li><a href="#">Eczema</a></li>
                                    <li><a href="#">Eye Health</a></li>
                                </ul>
                            </div>
                            <div class="mega-menu-section initial-items">
                                <h4>Other Conditions</h4>
                                <ul class="mega-menu-links">
                                    <li><a href="#">Heart Disease</a></li>
                                    <li><a href="#">HIV & AIDS</a></li>
                                    <li><a href="#">Lung Disease</a></li>
                                    <li><a href="#">Lupus</a></li>
                                    <li><a href="#">Mental Health</a></li>
                                    <li><a href="#">Multiple Sclerosis</a></li>
                                </ul>
                            </div>
                            <div class="mega-menu-section initial-items">
                                <h4>More Conditions</h4>
                                <ul class="mega-menu-links">
                                    <li><a href="#">Migraine</a></li>
                                    <li><a href="#">Pain Management</a></li>
                                    <li><a href="#">Psoriasis</a></li>
                                    <li><a href="#">Psoriatic Arthritis</a></li>
                                    <li><a href="#">Rheumatoid Arthritis</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link has-dropdown">Drugs & Supplements<span class="arrow"></span></a>
                    <div class="dropdown">
                        <a href="#" class="dropdown-item">Drugs</a>
                        <a href="#" class="dropdown-item">Supplements</a>
                        <a href="#" class="dropdown-item">Pill Identifier</a>
                        <a href="#" class="dropdown-item">Interaction Checker</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link has-dropdown">
                        Well-Being
                        <span class="arrow"></span>
                    </a>
                    <div class="dropdown">
                        <div class="mega-menu">
                            <div class="mega-menu-section initial-items">
                                <h4>Health & Wellness</h4>
                                <ul class="mega-menu-links">
                                    <li><a href="#">Aging Well</a></li>
                                    <li><a href="#">Diet & Weight Management</a></li>
                                    <li><a href="#">Fitness & Exercise</a></li>
                                    <li><a href="#">Food & Recipes</a></li>
                                    <li><a href="#">Health & Balance</a></li>
                                </ul>
                            </div>
                            <div class="mega-menu-section initial-items">
                                <h4>Life Stages</h4>
                                <ul class="mega-menu-links">
                                    <li><a href="#">Baby</a></li>
                                    <li><a href="#">Children's Health</a></li>
                                    <li><a href="#">Teen Health</a></li>
                                    <li><a href="#">Men's Health</a></li>
                                    <li><a href="#">Women's Health</a></li>
                                </ul>
                            </div>
                            <div class="mega-menu-section initial-items">
                                <h4>Relationships</h4>
                                <ul class="mega-menu-links">
                                    <li><a href="#">Birth Control</a></li>
                                    <li><a href="#">Parenting</a></li>
                                    <li><a href="#">Pregnancy</a></li>
                                    <li><a href="#">Sex & Relationships</a></li>
                                    <li><a href="#">Healthy Beauty</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">Symptom Checker</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">Find a Doctor</a>
                </li>
                <li class="nav-item more-item">
                    <a href="#" class="nav-link has-dropdown">
                        More
                        <span class="arrow"></span>
                    </a>
                    <div class="dropdown">
                        <a href="#" class="dropdown-item">News</a>
                        <a href="#" class="dropdown-item">Blogs</a>
                        <a href="#" class="dropdown-item">Newsletters</a>
                        <a href="#" class="dropdown-item">Surveys</a>
                        <a href="#" class="dropdown-item">Best Hospitals</a>
                        <a href="#" class="dropdown-item">Support Groups</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Header -->
    <header class="dashboard-header">
        <div class="container">
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <h2 id="userName">Welcome back!</h2>
                    <p id="userEmail">Loading your profile...</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="dashboard-content">
        <div class="container">
            <div class="welcome-section">
                <h1>Your Dashboard</h1>
                <p>Welcome to Plexus Care. Here's what you can do today.</p>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-comment-medical"></i> Start a Chat</h3>
                    <p>Connect with our AI assistant for immediate support and guidance.</p>
                    <button class="btn btn-primary" id="startChatBtn">Start Chat</button>
                </div>

                <div class="dashboard-card">
                    <h3><i class="fas fa-calendar-check"></i> Book a Session</h3>
                    <p>Schedule a one-on-one session with a licensed psychologist.</p>
                    <button class="btn btn-secondary" id="bookSessionBtn">Book Now</button>
                </div>

                <div class="dashboard-card">
                    <h3><i class="fas fa-book"></i> Journal</h3>
                    <p>Write down your thoughts and track your mood over time.</p>
                    <button class="btn btn-secondary" id="journalBtn">Write Entry</button>
                </div>
            </div>

            <div class="dashboard-card">
                <h3><i class="fas fa-history"></i> Recent Activity</h3>
                <div id="recentActivity">
                    <p>Your recent activity will appear here.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Load navigation first since it's essential for mobile -->
    <!-- Navigation Scripts -->
    <script src="js/mobile-nav.js" defer></script>
    
    <!-- Main application script -->
    <script type="module">
        // Import Supabase client
        import { supabase } from './js/init-supabase.js';
        
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', async () => {
            // DOM Elements
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            const userAvatar = document.getElementById('userAvatar');
            const logoutBtn = document.getElementById('logoutBtn');
            const startChatBtn = document.getElementById('startChatBtn');
            const bookSessionBtn = document.getElementById('bookSessionBtn');
            const journalBtn = document.getElementById('journalBtn');
            
            // Check authentication status
            await checkAuth();
            
            // Event listeners
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            
            // Check if user is logged in
            async function checkAuth() {
                try {
                    const { data: { user }, error } = await supabase.auth.getUser();

                    if (error || !user) {
                        window.location.href = 'auth.html';
                        return;
                    }

                    updateUI(user);
                } catch (error) {
                    console.error('Authentication error:', error);
                    window.location.href = 'auth.html';
                }
            }

            // Update UI with user data
            function updateUI(user) {
                const name = user.user_metadata?.full_name || user.email?.split('@')[0] || 'User';
                const email = user.email || '';
                const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();

                if (userName) userName.textContent = `Hello, ${name.split(' ')[0]}!`;
                if (userEmail) userEmail.textContent = email;

                // Set avatar with initials
                if (userAvatar) {
                    userAvatar.innerHTML = initials || '<i class="fas fa-user"></i>';
                }
            }

            // Handle logout
            async function handleLogout() {
                try {
                    await supabase.auth.signOut();
                    window.location.href = 'auth.html';
                } catch (error) {
                    console.error('Logout error:', error);
                }
            }

            // Add event listeners for dashboard actions
            if (startChatBtn) {
                startChatBtn.addEventListener('click', () => {
                    // Add chat functionality here
                    alert('Chat functionality will be implemented soon!');
                });
            }

            if (bookSessionBtn) {
                bookSessionBtn.addEventListener('click', () => {
                    // Add booking functionality here
                    alert('Booking functionality will be implemented soon!');
                });
            }

            if (journalBtn) {
                journalBtn.addEventListener('click', () => {
                    // Add journal functionality here
                    alert('Journal functionality will be implemented soon!');
                });
            }

            // Make updateUI available in global scope for other scripts
            window.updateUI = updateUI;
        });
    </script>
</body>

</html>